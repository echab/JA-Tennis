"use strict";angular.module("jat",["ui.bootstrap","ui.bootstrap.modal","jat.services.selection","jat.services.find","jat.services.undo","jat.services.type","jat.main"]).constant("appName","JA-Tennis").constant("appVersion","0.1").directive("appVersion",["appName","appVersion",function(a,b){return{template:a+" v"+b}}]);var models;!function(a){!function(a){a[a.Normal=0]="Normal",a[a.Final=1]="Final",a[a.PouleSimple=2]="PouleSimple",a[a.PouleAR=3]="PouleAR"}(a.DrawType||(a.DrawType={}));var b=a.DrawType;!function(a){a[a.None=0]="None",a[a.Create=1]="Create",a[a.PlusEchelonne=2]="PlusEchelonne",a[a.PlusEnLigne=3]="PlusEnLigne",a[a.Mix=4]="Mix"}(a.GenerateType||(a.GenerateType={}));var c=a.GenerateType;!function(a){a[a.None=0]="None",a[a.Tournament=1]="Tournament",a[a.Player=2]="Player",a[a.Event=3]="Event",a[a.Draw=4]="Draw",a[a.Match=5]="Match",a[a.Box=6]="Box"}(a.ModelType||(a.ModelType={}));var d=a.ModelType;!function(a){a[a.Build=0]="Build",a[a.Plan=1]="Plan",a[a.Play=2]="Play",a[a.Lock=3]="Lock"}(a.Mode||(a.Mode={}));var e=a.Mode}(models||(models={}));var jat;!function(a){var b;!function(a){function b(a){return a&&"score"in a}function c(a){return a.type===models.DrawType.PouleSimple||a.type===models.DrawType.PouleAR}function d(a){var b=a._draw;return c(a._draw)?a.position%b.nbColumn*(b.nbColumn+1):a.position}function e(a){return c(a._draw)?a.position>=a._draw.nbColumn*a._draw.nbColumn:!1}function f(a){if(c(a._draw)){var b=a._draw.nbColumn;return a.position%b+b*b}return(a.position<<1)+2}function g(a){if(c(a._draw)){var b=a._draw.nbColumn;return Math.floor(a.position/b)+b*b}return(a.position<<1)+1}function h(a,b){if(!a)throw b||"Assertion is false"}var i=32,j=32,k=-1,l=function(){function a(a,b,c){this.find=a,this.rank=b,this.guid=c,this._drawLibs={}}return a.prototype.newDraw=function(a,b,c){var d={};return angular.isObject(b)&&angular.extend(d,b),d.id=d.id||this.guid.create("d"),delete d.$$hashKey,d.type=d.type||models.DrawType.Normal,d.nbColumn=d.nbColumn||3,d.nbOut=d.nbOut||1,c&&(d._previous=c),d.minRank||(d.minRank=c&&c.maxRank?this.rank.next(c.maxRank):"NC"),d.maxRank&&this.rank.compare(d.minRank,d.maxRank)>0&&(d.maxRank=d.minRank),d._event=a,d},a.prototype.initDraw=function(a,b){if(a._event=b,a.type=a.type||0,a.nbColumn=a.nbColumn||0,a.nbOut=a.nbOut||0,a.boxes)for(var c=a.boxes.length-1;c>=0;c--){var d=a.boxes[c];this.initBox(d,a)}},a.prototype.resetDraw=function(a,b){var c=this.nextGroup(a);if(c&&a.boxes)for(var d=0;d<c.length;d++){var e=c[d].boxes;if(e)for(var f=0;f<e.length;f++){var g=e[f];g&&g.qualifOut&&this.setPlayerOut(g)}}a.boxes=[],a.nbColumn=this._drawLibs[a.type].nbColumnForPlayers(a,b)},a.prototype.newBox=function(a,b,c){var d={};if(angular.isObject(b))angular.extend(d,b);else if(angular.isString(b)){var e=d;e.score=void 0,e.matchFormat=b}return angular.isNumber(c)&&(d.position=c),this.initBox(d,a),d},a.prototype.initBox=function(a,b){a._draw=b,a._player=this.getPlayer(a)},a.prototype.nbColumnForPlayers=function(a,b){return this._drawLibs[a.type].nbColumnForPlayers(a,b)},a.prototype.getSize=function(a){return this._drawLibs[a.type].getSize(a)},a.prototype.computePositions=function(a){return this._drawLibs[a.type].computePositions(a)},a.prototype.resize=function(a,b,c){this._drawLibs[a.type].resize(a,b,c)},a.prototype.generateDraw=function(a,b,c){return this._drawLibs[a.type].generateDraw(a,b,c)},a.prototype.refresh=function(a){a._refresh=new Date},a.prototype.updateQualif=function(a){for(var b=[],c=a.boxes.length-1;c>=0;c--){var d=a.boxes[c];d.qualifIn&&b.push(d)}for(tool.shuffle(b),c=b.length-1;c>=0;c--)this.setPlayerIn(b[c],0);for(c=b.length-1;c>=0;c--)this.setPlayerIn(b[c],c+1)},a.prototype.getPlayer=function(a){return this.find.byId(a._draw._event._tournament.players,a.playerId)},a.prototype.groupBegin=function(a){for(var b=a;b&&b.suite&&b._previous;)b=b._previous;return b},a.prototype.groupEnd=function(a){for(var b=this.groupBegin(a);b&&b._next&&b._next.suite;)b=b._next;return b},a.prototype.group=function(a){for(var b=[],c=this.groupBegin(a);c&&(b.push(c),c=c._next,!c||c.suite););return b},a.prototype.previousGroup=function(a){var b=this.groupBegin(a);return b&&b._previous?this.group(b._previous):null},a.prototype.nextGroup=function(a){var b=this.groupEnd(a);return b&&b._next?this.group(b._next):null},a.prototype.isCreneau=function(a){return a&&"score"in a&&(!!a.place||!!a.date)},a.prototype.findSeeded=function(a,b){h(b>=1&&i>=b);for(var c=angular.isArray(a)?a:this.group(a),d=0;d<c.length;d++)for(var e=c[d].boxes,f=0;f<e.length;f++){var g=e[f];if(g.seeded===b)return g}return null},a.prototype.findPlayerIn=function(a,b){h(b>=1&&j>=b);for(var c=angular.isArray(a)?a:this.group(a),d=0;d<c.length;d++){var e=c[d],f=this._drawLibs[e.type].findPlayerIn(e,b);if(f)return f}},a.prototype.findPlayerOut=function(a,b){h(b>=1&&j>=b);for(var c=angular.isArray(a)?a:this.group(a),d=0;d<c.length;d++){var e=c[d],f=this._drawLibs[e.type].findPlayerOut(e,b);if(f)return f}for(var g=0,d=0;d<c.length;d++){var e=c[d];e.type>=2&&(g+=e.nbOut)}return g>=b?-2:null},a.prototype.findAllPlayerOut=function(a,b){var c=angular.isArray(a)?a:this.group(a);if(c){for(var d=[],e=1;j>=e;e++)this.findPlayerOut(c,e)&&d.push(b?k:e);return d}},a.prototype.findAllPlayerOutBox=function(a){var b=angular.isArray(a)?a:this.group(a);if(b){for(var c=[],d,e=1;j>=e;e++)(d=this.findPlayerOut(b,e))&&c.push(d);return c}},a.prototype.setPlayerIn=function(a,b,c){return this._drawLibs[a._draw.type].setPlayerIn(a,b,c)},a.prototype.setPlayerOut=function(a,b){return this._drawLibs[a._draw.type].setPlayerOut(a,b)},a.prototype.computeScore=function(a){return this._drawLibs[a.type].computeScore(a)},a.prototype.MetJoueur=function(a,c,d){if(a.playerId!==c.id&&a.playerId&&!this.EnleveJoueur(a))throw"Error";var f=a,g=b(a)?a:void 0;a.playerId=c.id,a._player=c,e(a)||g&&(g.date=void 0,g.place=void 0);var h=a;if(h.qualifOut){var i=this.nextGroup(a._draw);if(i){var f=this.findPlayerIn(i,h.qualifOut);if(f&&!f.playerId&&!this.MetJoueur(f,c,!0))throw"Error"}}return!0},a.prototype.SetResultat=function(a,b){if(b.playerId){if(!this.MetJoueur(a,b._player))throw"Error"}else if(!this.EnleveJoueur(a))throw"Error";return a.score=b.score,this.computeScore(a._draw),!0},a.prototype.MetCreneau=function(a,c){return h(b(a)),a.place=c.place,a.date=c.date,!0},a.prototype.EnleveCreneau=function(a){return h(b(a)),a.place=void 0,a.date=void 0,!0},a.prototype.MetPointage=function(a,b){return!0},a.prototype.EnleveJoueur=function(a,c){var d=a;if(!d.playerId&&!d.score)return!0;var e=this.nextGroup(a._draw),f=a,g;if((g=f.qualifOut)&&e){var h=this.findPlayerIn(e,g);if(h&&!this.EnleveJoueur(h,!0))throw"Error"}a.playerId=a._player=void 0,b(a)&&(d.score="");var h=a;return!0},a.prototype.LockBoite=function(a){if(h(!!a),d(a)===a.position,h(!!a),a.hidden)return!0;a.locked=!0;var b=this.previousGroup(a._draw);if(b){var c=a;if(c.qualifIn){var e=this.findPlayerOut(b,c.qualifIn);e&&(e.locked=!0)}}return!0},a.prototype.DelockBoite=function(a){if(a.hidden)return!0;delete a.locked;var b=this.previousGroup(a._draw);if(b){var c=a;if(c.qualifIn){var d=this.findPlayerOut(b,c.qualifIn);d&&delete d.locked}}return!0},a.prototype.RempliBoite=function(a,d){var e=a,f=d,g=b(a)?a:void 0,h=b(d)?d:void 0;if(e.qualifIn&&e.qualifIn!=f.qualifIn){if(!this.setPlayerIn(a))throw"Error"}else{if(!this.EnleveJoueur(a))throw"Error";if(delete e.qualifIn,delete e.seeded,delete g.qualifOut,this.isCreneau(g)&&!this.EnleveCreneau(g))throw"Error"}if(f.qualifIn){if(!this.setPlayerIn(a,f.qualifIn,d._player))throw"Error"}else{if(d.playerId){if(!this.MetJoueur(a,d._player))throw"Error";g&&(g.score=h.score)}if(!c(a._draw)&&f.seeded&&(e.seeded=f.seeded),g){if(h.qualifOut&&!this.setPlayerOut(g,h.qualifOut))throw"Error";var i=this.boxesOpponents(g);if(i.box1&&i.box2&&(h.place||h.date)&&!this.MetCreneau(g,h))throw"Error";if(!this.MetPointage(a,d))throw"Error";g.matchFormat=h.matchFormat,g.note=g.note}}return this.computeScore(a._draw),!0},a.prototype.DeplaceJoueur=function(a,b,c){if(b=this.newBox(a._draw,b),!this.RempliBoite(b,c))throw"Error";if(!this.RempliBoite(a,b))throw"Error";return!0},a.prototype.boxesOpponents=function(a){return this._drawLibs[a._draw.type].boxesOpponents(a)},a}();a.DrawLib=l,angular.module("jat.services.drawLib",["jat.services.find","jat.services.type","jat.services.guid"]).factory("drawLib",["find","rank","guid",function(a,b,c){return new l(a,b,c)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a,b){if(!a)throw b||"Assertion is false"}function c(a){b(a>0);for(var c=a,d=-1;c;c>>=1,d++);return d}function d(a){return 1<<a}var e=0,f=9,g=32,h=-1,i=!0,j=function(){function a(a,b,c,d,e){this.drawLib=a,this.knockoutLib=b,this.tournamentLib=c,this.rank=d,this.find=e,a._drawLibs[models.DrawType.Normal]=a._drawLibs[models.DrawType.Final]=this}return a.prototype.findBox=function(a,b,c){var d=this.find.by(a.boxes,"position",b);return!d&&c&&(d=this.drawLib.newBox(a,void 0,b)),d},a.prototype.nbColumnForPlayers=function(a,b){for(var c=this.knockoutLib,d=c.columnMin(a.nbOut),e=d+1;c.countInCol(e,a.nbOut)<b&&f>e;e++);if(e>=f)throw"Max_COL is reached "+e;return e-d+1},a.prototype.resize=function(a,b,c){var d=this.knockoutLib;if(c&&(a.nbColumn=this.nbColumnForPlayers(a,c)),b&&a.nbOut!==b.nbOut){var e=d.columnMax(a.nbColumn,a.nbOut)-d.columnMax(b.nbColumn,b.nbOut);if(0!=e)for(var f=d.positionTopCol(e),g=a.boxes.length-1;g>=0;g--){var h=a.boxes[g];h.position=this.positionPivotLeft(h.position,f)}}},a.prototype.generateDraw=function(a,b,c){if(b===models.GenerateType.Create){var d=tool.filledArray(f,0),e=this.tournamentLib.GetJoueursInscrit(a),g=c>=0?a._event.draws[c]:a._previous;g&&(e=e.concat(this.drawLib.findAllPlayerOut(g,!0))),this.drawLib.resetDraw(a,e.length),this.RempliMatchs(a,d,e.length-a.nbOut)}else{if(d=this.CompteMatchs(a),b===models.GenerateType.PlusEchelonne){if(!this.TirageEchelonne(a,d))return}else if(b===models.GenerateType.PlusEnLigne&&!this.TirageEnLigne(a,d))return;e=this.GetJoueursTableau(a)}return this.tournamentLib.TriJoueurs(e),a=this.ConstruitMatch(a,d,e),[a]},a.prototype.RempliMatchs=function(a,b,c,d){var e=this.knockoutLib,g=e.columnMin(a.nbOut);d=d||g;for(var h=d;f>=h;h++)b[h]=0;for(var i=Math.max(d,g);c&&f>i;i++){var j=Math.min(c,e.countInCol(i,a.nbOut));i>g&&(j=Math.min(j,2*b[i-1])),b[i]=j,c-=j}},a.prototype.CompteMatchs=function(a){var b=this.knockoutLib,c,d,e,g,h=new Array(f),i=b.columnMin(a.nbOut),j=i;h[j]=a.nbOut;var k=-h[j],l=b.columnMax(a.nbColumn,a.nbOut);for(j++;l>=j;j++){e=0;var m=b.positionBottomCol(j),n=b.positionTopCol(j);for(c=m;n>=c;c++){var o=this.findBox(a,c);o&&(this.isJoueurNouveau(o)||o.qualifIn)&&e++}if(h[j]=2*h[j-1]-e,k+=e-h[j],e||(d=j),!h[j])break}for(j++;l>=j;j++){e=0;var m=b.positionBottomCol(j),n=b.positionTopCol(j);for(c=m;n>=c;c++){var o=this.findBox(a,c);o&&(this.isJoueurNouveau(o)||o.qualifIn)&&e++}if(k+=e,e){this.RempliMatchs(a,h,e,d);break}}for(j=i,k=-h[j];l>=j;j++){e=0;var m=b.positionBottomCol(j),n=b.positionTopCol(j);for(c=m;n>=c;c++){var o=this.findBox(a,c);o&&(this.isJoueurNouveau(o)||o.qualifIn)&&e++}k+=e}for(j=i;l>=j;j++){if(h[j]>k){this.RempliMatchs(a,h,k,j);break}k-=h[j]}for(g=!1,k=0,j=i;l>j;j++)if(k+=h[j],h[j]){if(g){this.RempliMatchs(a,h,k,j+1);break}}else g=!0;return h},a.prototype.TirageEchelonne=function(a,b){for(var c=this.knockoutLib,d=c.columnMin(a.nbOut),e=c.columnMax(a.nbColumn,a.nbOut),g=f-1;g>d;g--)if(void 0!==b[g]&&b[g]>1&&e>g+1){if(b[g+1]+1>2*(b[g]-1))continue;return b[g]--,g++,b[g]++,!0}return!1},a.prototype.TirageEnLigne=function(a,b){for(var c=this.knockoutLib,d=c.columnMin(a.nbOut),e=0,g=f-1;g>d;g--)if(void 0!==b[g]){var h=Math.min(e+b[g],c.countInCol(g,a.nbOut));if(g>d&&(h=Math.min(h,2*b[g-1])),b[g]<h)return b[g]++,e--,this.RempliMatchs(a,b,e,g+1),!0;e+=b[g]}return!1},a.prototype.GetJoueursTableau=function(a){for(var b=[],c=0;c<a.boxes.length;c++){var d=a.boxes[c];d&&(d.qualifIn?b.push(d.qualifIn):this.isJoueurNouveau(d)&&b.push(d._player))}return b},a.prototype.ConstruitMatch=function(a,b,c){var d=this.knockoutLib,e=this.drawLib.newDraw(a._event,a);e.boxes=[];for(var f=d.columnMin(e.nbOut),h=d.columnMax(e.nbColumn,e.nbOut),j=[],k=f;h>=k;k++)for(var l=d.positionBottomCol(k),m=d.positionTopCol(k),n=l;m>=n;n++)i?j[this.iOrdreQhb(n,e.nbOut)]=n:j[this.iOrdreQ(n,e.nbOut)]=n;var o=e.nbOut;1==o&&(o=d.countInCol(h-f>>1));var p=d.positionMax(e.nbColumn,e.nbOut),q=new Array(p+1),r=0,s=0,t=0;k=-1;for(var u=0;p>=u;u++){var v=j[u];if(-1!==v){d.column(v)!=k&&(k=d.column(v),s=b[k]||0,t=k>f?2*b[k-1]-s:0);var w=d.positionMatch(v);if(t>0){if(q[w]){r++,t--;var x=this.drawLib.newBox(e,e._event.matchFormat,v);e.boxes.push(x)}}else if(s>0&&(k===f||q[w])){q[v]=!0,s--;var y=this.drawLib.newBox(e,e._event.matchFormat,v);y.score="",e.boxes.push(y)}if(r>=c.length)break}}for(r=0;u>0;u--)if(v=j[u],-1!==v){if(!q[v]&&q[d.positionMatch(v)]){var z="number"==typeof c[r]?c[r]:0;if(z){var A=this.findBox(e,d.positionOpponent(v));if(A&&A.qualifIn)for(var B=r+1;B>=o;B--)if(angular.isObject(c[B])){var C=c[B];c[B]=z,c[r]=C,z=0;break}}var D=this.findBox(e,v);D&&(delete D.score,z?this.drawLib.setPlayerIn(D,z):(this.drawLib.MetJoueur(D,c[r]),e.minRank&&this.rank.isNC(e.minRank)&&e.maxRank&&this.rank.isNC(e.maxRank)||(B=i?this.iTeteSerieQhb(v,e.nbOut):this.iTeteSerieQ(v,e.nbOut),o>=B&&!this.drawLib.findSeeded(e,B)&&(D.seeded=B))),r++)}if(r>c.length)break}if(e.type!==models.DrawType.Final){var E=this.drawLib.group(e);if(E)for(n=1;g>=n&&this.drawLib.findPlayerOut(E,n);n++);else n=1;l=d.positionBottomCol(f),m=d.positionTopCol(f);for(var v=m;v>=l&&g>=n;v--,n++){var F=this.findBox(e,v);F&&this.drawLib.setPlayerOut(F,n)}}return e},a.prototype.boxesOpponents=function(a){var b=this.knockoutLib,c=b.positionOpponent1(a.position),d=b.positionOpponent2(a.position);return{box1:this.find.by(a._draw.boxes,"position",c),box2:this.find.by(a._draw.boxes,"position",d)}},a.prototype.getSize=function(a){var b=this.knockoutLib;return a&&a.nbColumn&&a.nbOut?{width:a.nbColumn,height:b.countInCol(b.columnMax(a.nbColumn,a.nbOut),a.nbOut)}:{width:1,height:1}},a.prototype.computePositions=function(a){var b=this.knockoutLib;if(a&&a.nbColumn&&a.nbOut&&a.boxes&&a.boxes.length){for(var c=[],d=b.positionMin(a.nbOut),e=b.positionMax(a.nbColumn,a.nbOut),f=a.nbColumn-1+b.columnMin(a.nbOut),g=e;g>=d;g--){var h=b.column(g),i=b.positionTopCol(h),j=f-h,k=b.positionTopCol(j-1)+2;c[g]={x:j,y:(i-g)*k+k/2-.5};var l=this.find.by(a.boxes,"position",g);l&&(l._x=c[g].x,l._y=c[g].y)}return c}},a.prototype.computeScore=function(a){return!0},a.prototype.isJoueurNouveau=function(a){if(!a)return!1;var b=a,c=this.boxesOpponents(a);return a.playerId&&(!!b.qualifIn||!(c.box1&&c.box1.playerId||c.box2&&c.box2.playerId))},a.prototype.setPlayerIn=function(a,c,d){var e=a._draw;if(c){var f=this.drawLib.previousGroup(e);if(!d&&f&&f.length&&c!==h){var g=this.drawLib.findPlayerOut(f,c);angular.isObject(g)&&(d=g._player)}a.qualifIn&&(this.setPlayerIn(a)||b(!1)),d&&(this.drawLib.MetJoueur(a,d)||b(!1)),c!==h&&this.drawLib.findPlayerIn(e,c)||(a.qualifIn=c,this.iBoiteDeGauche(a.position,e,!0,function(a){a.hidden=!0}))}else a.qualifIn=0,this.drawLib.previousGroup(e)&&!this.drawLib.EnleveJoueur(a)&&b(!1),this.iBoiteDeGauche(a.position,e,!0,function(a){delete a.hidden});return!0},a.prototype.setPlayerOut=function(a,c){var d=this.drawLib.nextGroup(a._draw);if(c){if(d&&a.playerId&&a.qualifOut){var e=this.drawLib.findPlayerIn(d,c);if(e&&(b(e.playerId===a.playerId),!this.drawLib.EnleveJoueur(e)))throw"Can not remove player"}a.qualifOut&&(this.setPlayerOut(a)||b(!1)),a.qualifOut=c,d&&a.playerId&&e&&!this.drawLib.MetJoueur(e,a._player,!0)}else{if(d&&a.playerId){var e=this.drawLib.findPlayerIn(d,a.qualifOut);if(e&&(b(e.playerId&&e.playerId===a.playerId),!this.drawLib.EnleveJoueur(e,!0)))throw"Can not remove player"}delete a.qualifOut}return!0},a.prototype.findPlayerIn=function(a,c){if(b(c>=0),a.boxes)for(var d=a.boxes.length-1;d>=0;d--){var e=a.boxes[d];if(e){var f=e.qualifIn;if(f===c||!c&&f)return e}}},a.prototype.findPlayerOut=function(a,c){return b(c>0),c!==h&&a.boxes?this.find.by(a.boxes,"qualifOut",c):void 0},a.prototype.iBoiteDeGauche=function(a,b,e,f){for(var g,h=!1,i=a;;){var j=i-a*d(c(i+1)-c(a+1));do{j++,g=j+a*d(c(j+1));var k=this.findBox(b,g);if(!k)return;h=!!k.playerId||e}while(!h);h&&f(k),i=g}},a.prototype.positionPivotLeft=function(a,b){return a+b*d(c(a+1))},a.prototype.iTeteSerieQ=function(a,c){var d=this.knockoutLib;if(b(c>=1&&c<=d.countInCol(d.column(a))),d.column(a)===d.columnMin(c))return c===1<<d.column(c-1)?0===a?1:this.iTeteSerieQ(a,1):1+this.iPartieQ(a,c);var e=this.iTeteSerieQ(d.positionMatch(a),c),f,g,h;return g=c==1<<d.column(c-1)?a:this.iDecaleGaucheQ(a,c),f=!!(1&g),(h=d.column(g))>1&&g>d.positionTopCol(h)-(d.countInCol(h,c)>>1)&&(f=!f),f?e:1+d.countInCol(d.column(a),c)-e},a.prototype.iOrdreQ=function(a,c){var d=this.knockoutLib;return b(c>=1&&c<=d.countInCol(d.column(a))),this.iTeteSerieQ(a,c)-1+d.countInCol(d.column(a),c)-c},a.prototype.iPartieQ=function(a,c){var d=this.knockoutLib;b(c>=1&&c<=d.countInCol(d.column(a)));var e=d.column(a);return Math.floor((a-d.positionBottomCol(e,c))/d.countInCol(e-d.columnMin(c)))},a.prototype.iDecaleGaucheQ=function(a,c){var d=this.knockoutLib;b(c>=1&&c<=d.countInCol(d.column(a)));var e=d.column(a);return a-this.iPartieQ(a,c)*d.countInCol(e-d.columnMin(c))-d.positionBottomCol(e,c)+d.positionBottomCol(e-d.columnMin(c))},a.prototype.iTeteSerieQhb=function(a,c){var d=this.knockoutLib;if(b(c>=1&&c<=d.countInCol(d.column(a))),d.column(a)===d.columnMin(c))return c===1<<d.column(c-1)?0==a?1:this.iTeteSerieQhb(a,1):1+this.iPartieQhb(a,c);var e=this.iTeteSerieQhb(d.positionMatch(a),c),f,g,h;return g=c===1<<d.column(c-1)?a:this.iDecaleGaucheQhb(a,c),f=!!(1&g),(h=d.column(g))>1&&g<=d.positionTopCol(h)-(d.countInCol(h)>>1)&&(f=!f),f?1+d.countInCol(d.column(a),c)-e:e},a.prototype.iOrdreQhb=function(a,c){var d=this.knockoutLib;return b(c>=1&&c<=d.countInCol(d.column(a))),this.iTeteSerieQhb(a,c)-1+d.countInCol(d.column(a),c)-c},a.prototype.iPartieQhb=function(a,c){var d=this.knockoutLib;b(c>=1&&c<=d.countInCol(d.column(a)));var e=d.column(a);return c-1-Math.floor((a-d.positionBottomCol(e,c))/d.countInCol(e-d.columnMin(c)))},a.prototype.iDecaleGaucheQhb=function(a,c){var d=this.knockoutLib;b(c>=1&&c<=d.countInCol(d.column(a)));var e=d.column(a);return a-(c-1-this.iPartieQhb(a,c))*d.countInCol(e-d.columnMin(c))-d.positionBottomCol(e,c)+d.positionBottomCol(e-d.columnMin(c))},a}();a.Knockout=j,angular.module("jat.services.knockout",["jat.services.drawLib","jat.services.tournamentLib","jat.services.type","jat.services.find","jat.services.knockoutLib"]).factory("knockout",["drawLib","knockoutLib","tournamentLib","rank","find",function(a,b,c,d,e){return new j(a,b,c,d,e)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.column=function(a){var b=-1;for(a++;a;a>>=1,b++);return b},a.prototype.columnMin=function(a){return a&&1!==a?this.column(a-2)+1:0},a.prototype.columnMax=function(a,b){return b&&1!==b?this.column(b-2)+a:a-1},a.prototype.positionTopCol=function(a){return(1<<a+1)-2},a.prototype.positionBottomCol=function(a,b){return b&&1!==b?this.positionTopCol(a)-this.countInCol(a,b)+1:(1<<a)-1},a.prototype.countInCol=function(a,b){return b&&1!==b?b*this.countInCol(a-this.columnMin(b),1):1<<a},a.prototype.positionMin=function(a){return a&&1!==a?this.positionBottomCol(this.columnMin(a),a):0},a.prototype.positionMax=function(a,b){return b&&1!==b?this.positionTopCol(this.columnMax(a,b)):(1<<a)-2},a.prototype.positionMatch=function(a){return a-1>>1},a.prototype.positionOpponent=function(a){return 1&a?a+1:a-1},a.prototype.positionOpponent1=function(a){return(a<<1)+2},a.prototype.positionOpponent2=function(a){return(a<<1)+1},a.prototype.positionOpponents=function(a){return{pos1:(a<<1)+2,pos2:(a<<1)+1}},a}();a.KnockoutLib=b,angular.module("jat.services.knockoutLib",[]).factory("knockoutLib",[function(){return new b}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a,b){if(!a)throw b||"Assertion is false"}function c(a){return"score"in a}function d(a,b){if(!a)return 1;if(!b)return-1;var c=a.toUpperCase(),d=b.toUpperCase();return c==d?0:d>c?-1:1}function e(a,b,c){var d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=new Date(b.getFullYear(),b.getMonth(),b.getDate());return Math.floor((e.getTime()-d.getTime())/c)}var f=32,g=32,h=-1,i=16,j=function(){function a(a,b,c,d,e,f,g,h,i){this.validation=a,this.knockout=b,this.drawLib=c,this.knockoutLib=d,this.tournamentLib=e,this.rank=f,this.category=g,this.score=h,this.find=i,a.addValidator(this)}return a.prototype.validatePlayer=function(a){return!0},a.prototype.validateGroup=function(a){var b=!0;if(a.suite){var c=this.find.indexOf(a._event.draws,"id",a.id);0!==c&&a._previous||(this.validation.errorDraw("IDS_ERR_TAB_SUITE_PREMIER",a),b=!1);var d=this.drawLib.group(a);d&&(a.type!==d[0].type&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_TYPE",a),b=!1),a.minRank!=d[0].minRank&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_MIN",a),b=!1),a.maxRank!=d[0].maxRank&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_MAX",a),b=!1))}var e=this.drawLib.previousGroup(a);e&&e[0].type!==models.DrawType.Final&&a.minRank&&e[0].maxRank&&this.rank.compare(a.minRank,e[0].maxRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLASSMAX_OVR",a),b=!1);var f=this.drawLib.nextGroup(a);f&&a.type!==models.DrawType.Final&&a.maxRank&&f[0].minRank&&this.rank.compare(f[0].minRank,a.maxRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLASSMAX_NEXT_OVR",a),b=!1);var h=g;if(!a.suite){for(h=g;h>=1&&!this.drawLib.findPlayerOut(d,h);h--);for(var i=1;h>=i;i++)this.drawLib.findPlayerOut(d,i)||(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_NO",a,void 0,"Q"+i),b=!1)}return b},a.prototype.validateMatches=function(a){var b=!0;return b},a.prototype.validateDraw=function(a){var j=!0,l=0,m=0,n=a._event._tournament,o=a.type>=2,p=this.knockoutLib;if(a.type!==models.DrawType.Normal&&a.type!==models.DrawType.Final)return!0;a.minRank&&a.maxRank&&this.rank.compare(a.maxRank,a.minRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLAST_INV",a),j=!1),a._event.maxRank&&this.rank.compare(a._event.maxRank,a.maxRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLASSLIM_OVR",a),j=!1),j=j&&this.validateGroup(a),j=j&&this.validateMatches(a);var q=p.columnMax(a.nbColumn,a.nbOut),r=new Array(q+1);r[q]="NC";for(var s=0;s<a.boxes.length;s++){var t=a.boxes[s],u=c(t)?void 0:t,v=c(t)?t:void 0,w=t.position,x=p.column(w);w===p.positionTopCol(x)&&q>x&&(r[x]=r[x+1]),u&&u.order<0&&!u.qualifIn&&!t.hidden&&(this.validation.errorDraw("IDS_ERR_TAB_DUPLI",a,u),j=!1);var y=t._player;if(y&&u&&this.knockout.isJoueurNouveau(u)&&!u.qualifIn&&(y.rank?(this.rank.within(y.rank,a.minRank,a.maxRank)||(this.validation.errorDraw("IDS_ERR_CLAST_MIS",a,u,y.rank),j=!1),r[x]<y.rank&&(r[x]=y.rank),q>x&&r[x+1]&&this.rank.compare(y.rank,r[x+1])<0&&(this.validation.errorDraw("IDS_ERR_CLAST_PROGR",a,u,y.rank),j=!1)):(this.validation.errorDraw("IDS_ERR_CLAST_NO",a,u),j=!1),this.tournamentLib.isSexeCompatible(a._event,y.sexe)?this.tournamentLib.isRegistred(a._event,y)||this.validation.errorDraw("IDS_ERR_INSCR_NO",a,u):this.validation.errorDraw("IDS_ERR_EPR_SEXE",a,u),this.category.isCompatible(a._event.category,y.category)||this.validation.errorDraw("IDS_ERR_CATEG_MIS",a,u)),v){b(p.positionOpponent1(w)<=p.positionMax(a.nbColumn,a.nbOut));var z=this.knockout.boxesOpponents(v);if(b(!!z.box1&&!!z.box2),v.score?(b(w<p.positionBottomCol(a.nbColumn,a.nbOut)),v.playerId||(this.validation.errorDraw("IDS_ERR_SCORE_VAINQ_NO",a,v),j=!1),this.score.isValid(v.score)||(this.validation.errorDraw("IDS_ERR_SCORE_BAD",a,v,v.score),j=!1),b(p.column(w)<q),z.box1.playerId&&z.box2.playerId?z.box1.playerId!=v.playerId&&z.box2.playerId!=v.playerId&&(this.validation.errorDraw("IDS_ERR_VAINQUEUR_MIS",a,v),j=!1):(this.validation.errorDraw("IDS_ERR_MATCH_JOUEUR_NO",a,v),j=!1)):v.playerId&&(this.validation.errorDraw("IDS_ERR_VAINQ_SCORE_NO",a,v,v._player.name),j=!1),!this.isMatchJoue(v)){var A=this.drawLib.boxesOpponents(z.box1),B=this.drawLib.boxesOpponents(z.box2);z.box1.playerId?z.box2.playerId?d(z.box1._player.club,z.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB1",a,v,z.box1._player.club),j=!1):this.isMatchJouable(z.box2)&&(d(z.box1._player.club,B.box1._player.club)?d(z.box1._player.club,B.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,v,z.box1._player.club),j=!1):(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,v,z.box1._player.club),j=!1)):o||(z.box2.playerId?this.isMatchJouable(z.box1)&&(d(z.box2._player.club,A.box1._player.club)?d(z.box2._player.club,A.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,v,z.box2._player.club),j=!1):(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,v,z.box2._player.club),j=!1)):this.isMatchJouable(z.box1)&&this.isMatchJouable(z.box2)&&(d(A.box1._player.club,B.box1._player.club)&&d(A.box1._player.club,B.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,v,A.box1._player.club),j=!1),d(A.box2._player.club,B.box1._player.club)&&d(A.box2._player.club,B.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,v,A.box2._player.club),j=!1)))}if(v.date){if(a._event.start&&v.date<a._event.start&&(this.validation.errorDraw("IDS_ERR_DATE_MATCH_EPREUVE",a,v,v.date.toDateString()),j=!1),a._event.end&&a._event.end<v.date&&(this.validation.errorDraw("IDS_ERR_DATE_MATCH_EPREUVE",a,v,v.date.toDateString()),j=!1),n._dayCount=e(n.info.start,n.info.end,k.Day)+1,n._dayCount){var C=e(v.date,n.info.start,k.Day);if(C>=0&&C<n._dayCount){var D=n._day[C];b(D.length<=i);for(var E=D.length-1;E>=0;E--){var F=D[E];F.position!=v.position&&F.place==v.place&&Math.abs(v.date.getTime()-F.date.getTime())<n.info.slotLength&&(this.validation.errorDraw("IDS_ERR_PLN_OVERLAP",a,v,v.date.toDateString()),j=!1)}}else this.validation.errorDraw("IDS_ERR_DATE_MATCH_TOURNOI",a,v,v.date.toDateString()),j=!1}b(p.positionOpponent1(w)<=p.positionMax(a.nbColumn,a.nbOut));var G=z.box1,F=z.box2;c(z.box1)&&G.date&&(v.date<G.date?(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,v,v.date.toDateString()),j=!1):v.date.getTime()<G.date.getTime()+(n.info.slotLength<<1)&&(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,v,v.date.toDateString()),j=!1)),c(z.box2)&&F.date&&(v.date<F.date?(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,v,v.date.toDateString()),j=!1):v.date.getTime()<F.date.getTime()+(n.info.slotLength<<1)&&(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,v,v.date.toDateString()),j=!1)),v.date&&!v.playerId&&!v.place&&n.places.length&&n._dayCount&&(this.validation.errorDraw("IDS_ERR_PLN_COURT_NO",a,v),j=!1)}}if(u){var H=u.qualifIn;if(H&&H!=h){l++,b(!o||w>=p.positionBottomCol(a.nbColumn,a.nbOut));var I=this.find.indexOf(a._event.draws,"id",a.id);0==I&&(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_TAB1",a,u),j=!1);var J;a.suite||!(J=this.drawLib.findPlayerIn(a,H))||J.position==w&&J._draw.id==a.id||(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_DUP",a,u),j=!1);var K=this.drawLib.previousGroup(a);K&&(J=this.drawLib.findPlayerOut(K,H),J?J.playerId!=u.playerId&&(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_PREC_MIS",a,u),j=!1):(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_PREC_NO",a,u),j=!1))}}if(v){var H=v.qualifOut;H&&(m++,J=this.drawLib.findPlayerOut(a,H),!J||J.position==w&&J._draw.id==a.id||(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_DUP",a,v),j=!1),a.type===models.DrawType.Final&&(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_FINAL",a,t),j=!1))}}if(!a.suite)for(var L=0,H=1;f>=H;H++)if(u=this.drawLib.findSeeded(a,H)){H>L+1&&(this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_NO",u._draw,u,"Seeded "+H),j=!1),c(u)&&(this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_ENTRANT",u._draw,u,"Seeded "+H),j=!1);for(var s=0;s<a.boxes.length;s++){var M=a.boxes[s];M.seeded==H&&M.position!==u.position&&(this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_DUP",u._draw,u,"Seeded "+H),j=!1)}L=H}if(!a.suite){var N=this.drawLib.previousGroup(a);if(N&&N.length)for(var H=1;g>=H;H++){var O=this.drawLib.findPlayerOut(N,H);u=this.drawLib.findPlayerIn(a,H),O&&!u&&(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_PREC_NO",a,void 0,"Q"+O.qualifOut),j=!1)}}return o&&m<a.nbOut&&(this.validation.errorDraw("IDS_ERR_POULE_SORTANT_NO",a),j=!1),a.type===models.DrawType.Final&&((a.suite||K[K.length-1].id!==a.id)&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_FINAL",a),j=!1),1!=a.nbOut&&(this.validation.errorDraw("IDS_ERR_TAB_FINAL_NQUAL",a),j=!1)),j},a.prototype.isMatchJoue=function(a){var b=this.drawLib.boxesOpponents(a);return!!a.playerId&&!!b.box1.playerId&&!!b.box2.playerId},a.prototype.isMatchJouable=function(a){if(!c(a))return!1;var b=this.drawLib.boxesOpponents(a);return!a.playerId&&!!b.box1.playerId&&!!b.box2.playerId},a}();a.KnockoutValidation=j;var k;!function(a){a[a.Day=864e5]="Day",a[a.Hour=36e5]="Hour"}(k||(k={})),angular.module("jat.services.validation.knockout",["jat.services.validation","jat.services.type","jat.services.knockoutLib"]).factory("knockoutValidation",["validation","knockout","drawLib","knockoutLib","tournamentLib","rank","category","score","find",function(a,b,c,d,e,f,g,h,i){return new j(a,b,c,d,e,f,g,h,i)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a,b){if(!a)throw b||"Assertion is false"}function c(a,b){return Math.floor(a/b)}function d(a,b){return a%b}function e(a){return a*(a+1)}function f(a){return a*a+1}function g(a,b){return a%b+b*b}function h(a,b){return Math.floor(a/b)+b*b}function i(a,b,c){return b*c+a}function j(a,b,e){var f=d(a,b),g=c(a,b);return e-b+f+e*(e-b+g)}function k(a){var b=a._draw.nbColumn;return a.position%b*(b+1)}function l(a,b){return b%a*(a+1)}function m(a,b){var c=a.nbColumn;return b%c+c*c}var n=0,o=22,p=8191,q=63,r=-1,s=function(){function a(a,b,c,d){this.drawLib=a,this.tournamentLib=b,this.ranking=c,this.find=d,a._drawLibs[models.DrawType.PouleSimple]=a._drawLibs[models.DrawType.PouleAR]=this}return a.prototype.findBox=function(a,b,c){var d=this.find.by(a.boxes,"position",b);return!d&&c&&(d=this.drawLib.newBox(a,void 0,b)),d},a.prototype.nbColumnForPlayers=function(a,b){return b},a.prototype.boxesOpponents=function(a){var b=a._draw.nbColumn,c=g(a.position,b),d=h(a.position,b);return{box1:this.find.by(a._draw.boxes,"position",c),box2:this.find.by(a._draw.boxes,"position",d)}},a.prototype.getSize=function(a){if(!a.nbColumn)return{width:1,height:1};var b=a.nbColumn;return{width:b+1,height:b}},a.prototype.computePositions=function(a){},a.prototype.resize=function(a,b,c){if(c)throw"Not implemnted";if(b&&a.nbColumn!==b.nbColumn){for(var d=b.nbColumn,e=a.nbColumn,f=e*(e+1)-1,g=a.boxes.length-1;g>=0;g--){var h=a.boxes[g],i=j(h.position,d,e),k=l(e,i);0>i||i>f||i===k||k>i&&a.type===models.DrawType.PouleSimple?a.boxes.splice(g,1):h.position=i}if(e>d)for(var g=e-d-1;g>=0;g--){var i=m(a,g),n=this.drawLib.newBox(a,void 0,i);a.boxes.push(n);var k=l(e,i);for(i-=e;i>=0;i-=e)if(!(i===k||k>i&&a.type===models.DrawType.PouleSimple)){var o=this.drawLib.newBox(a,void 0,i);o.score="",a.boxes.push(o)}}}},a.prototype.findPlayerIn=function(a,c){if(b(c>=0),a.boxes)for(var d=a.boxes.length-1;d>=0;d--){var e=a.boxes[d];if(e){var f=e.qualifIn;if(f===c||!c&&f)return e}}},a.prototype.findPlayerOut=function(a,c){if(b(c>0),c!==r&&a.boxes)for(var d=0;d<a.boxes.length;d++){var e=a.boxes[d];if(e&&e.qualifOut===c)return e}},a.prototype.setPlayerIn=function(a,c,d){var e=a._draw;if(c){var f=this.drawLib.previousGroup(e);if(!d&&f&&c!=r){var g=this.drawLib.findPlayerOut(f,c);angular.isObject(g)&&(d=g._player)}a.qualifIn&&(this.setPlayerIn(a)||b(!1)),d&&(this.drawLib.MetJoueur(a,d)||b(!1)),c!=r&&this.drawLib.findPlayerIn(e,c)||this.setPlayerIn(a,c)}else a.qualifIn=0,this.drawLib.previousGroup(e)&&!this.drawLib.EnleveJoueur(a)&&b(!1);return!0},a.prototype.setPlayerOut=function(a,c){var d=this.drawLib.nextGroup(a._draw),e=a._draw.boxes[k(a)],f=a._draw.boxes[m(a._draw,a.position)];
if(c){if(d&&a.playerId&&a.qualifOut){var g=this.drawLib.findPlayerIn(a._draw,c);g&&(b(g.playerId===a.playerId),this.drawLib.EnleveJoueur(g)||b(!1))}if(a.qualifOut&&(this.setPlayerOut(a)||b(!1)),this.setPlayerOut(a,c),e.playerId=f.playerId,this.drawLib.initBox(e,a._draw),d&&a.playerId){var g=this.drawLib.findPlayerIn(d,c);g&&(b(!g.playerId),this.drawLib.MetJoueur(g,a._player,!0)||b(!1))}}else{var h=a;if(d&&a.playerId){var g=this.drawLib.findPlayerIn(d,h.qualifOut);g&&(b(g.playerId&&g.playerId===a.playerId),this.drawLib.EnleveJoueur(g,!0)||b(!1))}delete h.qualifOut,e.playerId=void 0,this.drawLib.initBox(e,a._draw)}return!0},a.prototype.GetJoueursTableau=function(a){for(var b=[],c=this.drawLib.group(a),d=0;d<c.length;d++)for(var g=c[d],h=e(g.nbColumn),i=f(g.nbColumn),j=i;h>=j;j++){var k=this.findBox(g,j);k&&(k.qualifIn?b.push(k.qualifIn):k.playerId&&b.push(k._player))}return b},a.prototype.generateDraw=function(a,b,c){var d=this.drawLib.group(a),e=this.find.indexOf(a._event.draws,"id",d[0].id);-1===e&&(e=a._event.draws.length);var f=this.tournamentLib.GetJoueursInscrit(a),g=c>=0?o._event.draws[c]:void 0;g&&(f=f.concat(this.drawLib.findAllPlayerOut(g,!0))),this.tournamentLib.TriJoueurs(f);var h=a._event,i=Math.floor((f.length+(a.nbColumn-1))/a.nbColumn);if(i||(i=1),h.draws.length+i>=q)throw"Maximum refDraw count is reached";for(var j=[],k=a.name,n=0;i>n;n++){if(0===n)var o=a;else o=this.drawLib.newDraw(h,a),o.suite=!0;o.boxes=[],o.name=k+(i>1?" ("+(n+1)+")":"");for(var p=o.nbColumn-1;p>=0&&f.length;p--){var r=m(o,p),s=n+(o.nbColumn-p-1)*i,t=this.drawLib.newBox(o,void 0,r);if(o.boxes.push(t),s<f.length){var u="number"==typeof f[s]?f[s]:0;if(u){if(!this.drawLib.setPlayerIn(t,u))return}else if(!this.drawLib.MetJoueur(t,f[s]))return}var v=l(o.nbColumn,r);for(r-=o.nbColumn;r>=0;r-=o.nbColumn)if(!(r===v||v>r&&o.type===models.DrawType.PouleSimple)){var w=this.drawLib.newBox(o,void 0,r);w.score="",o.boxes.push(w)}}var x=this.findBox(o,m(o,o.nbColumn-1));x.seeded=n+1,j.push(o)}return j},a.prototype.computeScore=function(a){throw"Not implemented";var b;return!0},a}();a.Roundrobin=s,angular.module("jat.services.roundrobin",["jat.services.drawLib","jat.services.tournamentLib","jat.services.type","jat.services.find"]).factory("roundrobin",["drawLib","tournamentLib","ranking","find",function(a,b,c,d){return new s(a,b,c,d)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return"score"in a}var c=function(){function a(a){this.validation=a,a.addValidator(this)}return a.prototype.validatePlayer=function(a){return!0},a.prototype.validateDraw=function(a){var b=!0;return(a.type===models.DrawType.PouleSimple||a.type===models.DrawType.PouleAR)&&(b=b&&this.validatePoule(a),b=b&&this.validateMatches(a)),b},a.prototype.validatePoule=function(a){var b=!0;return b},a.prototype.validateMatches=function(a){for(var c=!0,d=0;d<a.boxes.length;d++){var e=a.boxes[d],f=b(e)?void 0:e,g=b(e)?e:void 0;e.playerId}return c},a}();a.RoundrobinValidation=c,angular.module("jat.services.validation.roundrobin",["jat.services.validation"]).factory("roundrobinValidation",["validation",function(a){return new c(a)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this._category={"-8ans":{ageMax:8},"-9ans":{ageMax:9},"-10ans":{ageMax:10},"-11ans":{ageMax:11},"-12ans":{ageMax:12},"-13ans":{ageMax:13},"-14ans":{ageMax:14},"-15ans":{ageMax:15},"-16ans":{ageMax:16},"-17ans":{ageMax:17},"-18ans":{ageMax:18},Senior:{ageMin:18,ageMax:34},"+35ans":{ageMin:35},"+45ans":{ageMin:45},"+55ans":{ageMin:55},"+65ans":{ageMin:60},"+70ans":{ageMin:70},"+75ans":{ageMin:75}},this._categories=[],this._index={};var a=new Date,b=new Date(a.getFullYear(),9,1);this.currentYear=a.getFullYear()+(a>b?1:0);for(var c in this._category)this._categories.push(c);for(var d=this._categories.length-1;d>=0;d--)this._index[this._categories[d]]=d}return a.prototype.list=function(){return this._categories},a.prototype.isValid=function(a){return this._index[a]>=0},a.prototype.compare=function(a,b){var c=this._index[a],d=this._index[b];return c-d},a.prototype.getAge=function(a){var b=this.currentYear-a.getFullYear();return b},a.prototype.ofDate=function(a){var b=this.getAge(a),c,d;for(c in this._category){var e=this._category[c];if(!(e.ageMax&&e.ageMax<b)){if(e.ageMin){if(e.ageMin<=b){d=c;continue}return d}return c}}},a.prototype.isCompatible=function(a,b){if(b||!a)return!0;var c=this._index.Senior,d=this._index[a];if(d===c)return!0;var e=this._category[a],f=this._category[b];if(c>d){if(f.ageMax<=e.ageMax)return!0}else if(e.ageMin<=f.ageMin)return!0;return!1},a}();a.CategoryFFT=b,angular.module("jat.services.fft.category",[]).service("category",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){angular.module("jat.services.type",["jat.services.fft.score","jat.services.fft.category","jat.services.fft.licence","jat.services.fft.matchFormat","jat.services.fft.rank","jat.services.fft.ranking"])}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return"score"in a}function c(a){var b=-1;for(a++;a;a>>=1,b++);return b}function d(a,b){return b&&1!==b?c(b-2)+a:a-1}function e(a){return(1<<a+1)-2}function f(a,b){return b&&1!==b?e(d(a,b)):(1<<a)-2}var g=function(){function a(a,b,c,d){this.validation=a,this.drawLib=b,this.knockout=c,this.find=d,a.addValidator(this)}return a.prototype.validatePlayer=function(a){var b=!0;return b},a.prototype.validateDraw=function(a){for(var d=!0,e=a.type>=2,g={},h=0,i=0;i<a.boxes.length;i++){var j=a.boxes[i],k=b(j)?void 0:j,l=b(j)?j:void 0,m=j._player;if(m&&!e){var n=c(j.position),o=g[m.rank];o?Math.abs(o-n)>1&&(this.validation.errorDraw("IDS_ERR_CLAST_PROGR2",a,j,m.rank),d=!1):g[m.rank]=n}if(!e&&l){var p=this.knockout.boxesOpponents(l);p.box1.qualifIn&&p.box2.qualifIn&&(this.validation.errorDraw("IDS_ERR_ENTRANT_MATCH",a,p.box1),d=!1)}k&&k.qualifIn&&h++,e&&h>1&&(this.validation.errorDraw("IDS_ERR_POULE_ENTRANT_OVR",a,j),d=!1)}if(a.type===models.DrawType.Final){var q=this.drawLib.findSeeded(a,1);if(!q){var r=this.find.by(a.boxes,"position",f(a.nbColumn,a.nbOut));this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_FINAL_NO",a,r),d=!1}}return d},a}();a.FFTValidation=g,angular.module("jat.services.validation.fft",["jat.services.validation"]).factory("fftValidation",["validation","drawLib","knockout","find",function(a,b,c,d){return new g(a,b,c,d)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.isValid=function(b){var c=a.reLicence.exec(b+" ");if(null===c)return!1;var d=parseInt(c[1]),e=a.keys.charAt(d%23);return e==c[2]},a.reLicence=/^([0-9]{7})([A-HJ-NPR-Z])$/,a.keys="ABCDEFGHJKLMNPRSTUVWXYZ",a}();a.LicenceFFT=b,angular.module("jat.services.fft.licence",[]).service("licence",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this._matchFormats={A:{code:"A",name:"A: traditionnel (3 sets à 6 jeux)"},B:{code:"B",name:"B: traditionnel (3 sets à 6 jeux) - point décisif"},C:{code:"C",name:"C: 3 sets à 4 jeux - jeu décisif à 4/4"},D:{code:"D",name:"D: 3 sets à 4 jeux - jeu décisif à 4/4 - point décisif"},E:{code:"E",name:"E: 3 sets à 3 jeux - jeu décisif à 2/2"},F:{code:"F",name:"F: 3 sets à 3 jeux - jeu décisif à 2/2 - point décisif"},G:{code:"G",name:"G: 3 jeux décisif"},H:{code:"H",name:"H: 3 sets à 4 jeux - jeu décisif à 3/3 - point décisif"},I:{code:"I",name:"I: 3 sets à 5 jeux - jeu décisif à 4/4 - point décisif"}}}return a.prototype.list=function(){return this._matchFormats},a}();a.MatchFormatFFT=b,angular.module("jat.services.fft.matchFormat",[]).service("matchFormat",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this._group={"4e série":"NC,40,30/5,30/4,30/3,30/2,30/1","3e série":"30,15/5,15/4,15/3,15/2,15/1","2e série":"15,5/6,4/6,3/6,2/6,1/6","1e série":"0,-1/6,-2/6,-3/6,-4/6,-5/6",promotion:"-15,-30"},this._groups=[],this._groupOf={},this._ranks=[],this._index={};var a;for(a in this._group){this._groups.push(a);var b=this._group[a].split(",");this._ranks=this._ranks.concat(b);for(var c=b.length-1;c>=0;c--)this._groupOf[b[c]]=a}for(var c=this._ranks.length-1;c>=0;c--)this._index[this._ranks[c]]=c}return a.prototype.list=function(){return this._ranks},a.prototype.isValid=function(a){return this._index[a]>=0},a.prototype.isNC=function(a){return"NC"===a},a.prototype.next=function(a){var b=this._index[a];return this._ranks[b+1]},a.prototype.previous=function(a){var b=this._index[a];return this._ranks[b-1]},a.prototype.compare=function(a,b){var c=this._index[a],d=this._index[b];return c-d},a.prototype.within=function(a,b,c){return(!b||this.compare(b,a)<=0)&&(!c||this.compare(a,c)<=0)},a.prototype.groups=function(){return this._groups},a.prototype.groupOf=function(a){return this._groupOf[a]},a}();a.RankFFT=b,angular.module("jat.services.fft.rank",[]).service("rank",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function b(a){this._champs=["Points:","Différence de Sets:","Différence de Jeux:"],this.Points=0,this._serviceScore=a}return b.prototype.Empty=function(){this.Points=0},b.prototype.isVide=function(){return 0===this.Points},b.prototype.NomChamp=function(a){return this._champs[a]},b.prototype.ValeurChamp=function(a){switch(a){case 0:return this.dPoint.toString();case 1:return Math.floor(this.dSet2/2).toString();case 2:return this.dJeu.toString()}},b.prototype.AddResultat=function(b,c,d){var e=new a.ScoreDeltaFFT(c,d);return this.dPoint+=e.deltaPoint(b>0),this.dSet2+=e.deltaSet(b>0),this.dJeu+=e.deltaJeu(b>0),!0},b.prototype.Ordre=function(){return(this.dPoint+128<<24)+(this.dSet2+128<<16)+(this.dJeu+32768)},b}();a.RankingFFT=b,angular.module("jat.services.fft.ranking",[]).service("ranking",["score",b])}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.isValid=function(b){var c=a.reScore.exec(b+" ");if(null===c)return!1;for(var d=b.split(/\s+/),e=0,f=0,g=0;g<d.length;g++){var h=d[g].split("/"),i=parseInt(h[0]),j=parseInt(h[1]);if(i>j&&i>=6){if(i>=7&&5>j)return!1;e++}else if(j>i&&j>=6){if(j>=7&&5>i)return!1;f++}}return!0},a.reScore=/^(([0-9]{1,2}\/[0-9]{1,2})\s+){2,5}(Ab )?$/,a}();a.ScoreFFT=b;var c=5,d=function(){function a(a,b){}return a.prototype.getnSet=function(){for(var a=0;c>a&&(this.m_Jeu[a].j1||this.m_Jeu[a].j2);)a++;return a-1},a.prototype.deltaSet=function(a){throw"Not implemented";for(var b=0,d=0;c>d&&(this.m_Jeu[d].j1||this.m_Jeu[d].j2);d++)b+=this.m_Jeu[d].j1>this.m_Jeu[d].j2?1:this.m_Jeu[d].j1<this.m_Jeu[d].j2?-1:0;var e;return e},a.prototype.deltaJeu=function(a){throw"Not implemented";for(var b=0,d=0;c>d&&(this.m_Jeu[d].j1||this.m_Jeu[d].j2);d++)b+=this.m_Jeu[d].j1-this.m_Jeu[d].j2;var e;return e},a.prototype.deltaPoint=function(a){throw"Not implemented";for(var b=0,d=0;c>d&&(this.m_Jeu[d].j1||this.m_Jeu[d].j2);d++)b+=this.m_Jeu[d].j1-this.m_Jeu[d].j2;var e,f;return b},a}();a.ScoreDeltaFFT=d,angular.module("jat.services.fft.score",[]).service("score",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e,f,g,h,i,j,k){this.$log=a,this.$http=b,this.$q=c,this.$window=d,this.selection=e,this.tournamentLib=f,this.drawLib=g,this.validation=h,this.undo=i,this.find=j,this.guid=k}return a.prototype.newTournament=function(){var a={id:this.guid.create("T"),info:{name:""},players:[],events:[]};return this.selection.select(a,models.ModelType.Tournament),a},a.prototype.loadTournament=function(a){var b=this,c=this.$q.defer();if(a)if("string"==typeof a)this.$http.get(a).success(function(d,e){d._url=a,b.tournamentLib.initTournament(d),b.selection.select(d,models.ModelType.Tournament),c.resolve(d)}).error(function(a,b){c.reject(a)});else{var d=new FileReader;d.addEventListener("loadend",function(){try{var e=angular.fromJson(d.result);e._url=a.name,b.tournamentLib.initTournament(e),b.selection.select(e,models.ModelType.Tournament),c.resolve(e)}catch(f){c.reject(f.message)}}),d.addEventListener("onerror",function(){return c.reject(d.error.name)}),d.addEventListener("onabort",function(){return c.reject("aborted")}),d.readAsText(a)}else{var e=this.$window.localStorage.tournament;if(e){var f=angular.fromJson(e);this.tournamentLib.initTournament(f),this.selection.select(f,models.ModelType.Tournament),c.resolve(f)}else c.reject("nothing in storage")}return c.promise},a.prototype.saveTournament=function(a,b){var c={};return tool.copy(a,c),b?void this.$http.post(b||a._url,c).success(function(a,b){}).error(function(a,b){}):void(this.$window.localStorage.tournament=angular.toJson(c))},a.prototype.addPlayer=function(a,b){var c=a.players;b.id=this.guid.create("p"),this.undo.insert(c,-1,b,"Add "+b.name,models.ModelType.Player),this.selection.select(b,models.ModelType.Player)},a.prototype.editPlayer=function(a,b){var c=this.selection.player===b,d=a._tournament.players,e=this.find.indexOf(d,"id",a.id,"Player to update not found");this.undo.update(d,e,a,"Edit "+a.name+" "+e,models.ModelType.Player),c&&this.selection.select(a,models.ModelType.Player)},a.prototype.removePlayer=function(a){var b=a._tournament.players,c=this.find.indexOf(b,"id",a.id,"Player to remove not found");this.undo.remove(b,c,"Delete "+a.name+" "+c,models.ModelType.Player),this.selection.player===a&&this.selection.select(b[c]||b[c-1],models.ModelType.Player)},a.prototype.addEvent=function(a,b,c){var d=a.events,e=c?this.find.indexOf(d,"id",c.id)+1:d.length;b.id=this.guid.create("e"),this.undo.insert(d,e,b,"Add "+b.name,models.ModelType.Event),this.selection.select(b,models.ModelType.Event)},a.prototype.editEvent=function(a,b){var c=this.selection.event===b,d=a._tournament.events,e=this.find.indexOf(d,"id",a.id,"Event to edit not found");this.undo.update(d,e,a,"Edit "+a.name+" "+e,models.ModelType.Event),c&&this.selection.select(a,models.ModelType.Event)},a.prototype.removeEvent=function(a){var b=a._tournament.events,c=this.find.indexOf(b,"id",a.id,"Event to remove not found");this.undo.remove(b,c,"Delete "+b[c].name+" "+c,models.ModelType.Event),this.selection.event===a&&this.selection.select(b[c]||b[c-1],models.ModelType.Event)},a.prototype.addDraw=function(a,b,c){var d=a._event.draws,e=c?this.find.indexOf(d,"id",c.id):d.length-1;if(b){var f=this.drawLib.generateDraw(a,b,e);if(!f||!f.length)return;this.undo.splice(d,e+1,0,f,"Add "+a.name,models.ModelType.Draw);for(var g=0;g<f.length;g++)this.drawLib.initDraw(f[g],a._event);this.selection.select(f[0],models.ModelType.Draw)}else a.id=this.guid.create("d"),this.undo.insert(d,e+1,a,"Add "+a.name,models.ModelType.Draw),this.selection.select(a,models.ModelType.Draw)},a.prototype.updateDraw=function(a,b,c){var d=this.selection.draw===b,e=this.drawLib.group(b||a);if(c){var f=this.drawLib.generateDraw(a,c,-1);if(!f||!f.length)return}else this.drawLib.resize(a,b);var g=a._event.draws;if(c&&f&&e&&f.length){var h=this.find.indexOf(g,"id",e[0].id,"Draw to edit not found");this.undo.splice(g,h,e.length,f,"Generate "+models.GenerateType[c]+" "+a.name,models.ModelType.Draw);for(var h=0;h<f.length;h++)this.drawLib.initDraw(f[h],a._event);a=f[0]}else{var h=this.find.indexOf(g,"id",a.id,"Draw to edit not found");this.undo.update(g,h,a,"Edit "+a.name+" "+h,models.ModelType.Draw)}(d||c)&&(this.selection.select(a,models.ModelType.Draw),this.drawLib.refresh(a))},a.prototype.updateQualif=function(a){var b=this;this.undo.newGroup("Update qualified",function(){return b.drawLib.updateQualif(a),!0},a)},a.prototype.removeDraw=function(a){var b=a._event.draws,c=this.find.indexOf(b,"id",a.id,"Draw to remove not found");this.undo.remove(b,c,"Delete "+a.name+" "+c,models.ModelType.Draw),this.selection.draw===a&&this.selection.select(b[c]||b[c-1],models.ModelType.Draw)},a.prototype.validateDraw=function(a){this.validation.resetDraw(a),this.validation.validateDraw(a),this.selection.draw===a&&this.drawLib.refresh(a)},a.prototype.editMatch=function(a,b){var c=this;this.drawLib.initBox(a,a._draw);var d=b._draw.boxes,e=this.find.indexOf(d,"position",a.position,"Match to edit not found");this.undo.newGroup("Edit match",function(){if(c.undo.update(d,e,a,"Edit "+a.position+" "+e,models.ModelType.Match),a.qualifOut){var b=c.drawLib.nextGroup(a._draw);if(b){var f=c.drawLib.findPlayerIn(b,a.qualifOut);f&&c.undo.update(f,"playerId",a.playerId,"Set player",function(){return c.drawLib.initBox(f,f._draw)})}}return!0})},a.prototype.erasePlanning=function(a){var b=this;this.undo.newGroup("Erase player",function(){return b.undo.update(a,"place",null),b.undo.update(a,"date",null),!0},a)},a}();a.MainLib=b,angular.module("jat.services.mainLib",["jat.services.selection","jat.services.find","jat.services.undo","jat.services.guid","jat.services.type","jat.services.tournamentLib","jat.services.drawLib","jat.services.knockout","jat.services.roundrobin","jat.services.validation","jat.services.validation.knockout","jat.services.validation.roundrobin","jat.services.validation.fft"]).factory("mainLib",["$log","$http","$q","$window","selection","tournamentLib","drawLib","knockout","roundrobin","validation","knockoutValidation","roundrobinValidation","fftValidation","undo","find","guid",function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return new b(a,c,d,e,f,g,h,k,o,p,q)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=6e4,c=1440*b,d=function(){function a(a,b,c){this.drawLib=a,this.rank=b,this.guid=c}return a.prototype.newTournament=function(a){var b={};return angular.isObject(a)&&angular.extend(b,a),this.initTournament(b),b},a.prototype.newInfo=function(a){var b={};return angular.isObject(a)&&angular.extend(b,a),b},a.prototype.initTournament=function(a){if(a.players)for(var d=a.players.length-1;d>=0;d--)this.initPlayer(a.players[d],a);if(a.events)for(var d=a.events.length-1;d>=0;d--)this.initEvent(a.events[d],a);a.info=a.info||{name:""},a.info.slotLength=a.info.slotLength||90*b,a.info.start&&a.info.end&&(a._dayCount=Math.floor((a.info.end.getTime()-a.info.start.getTime())/c+1))},a.prototype.newPlayer=function(a,b){var c={};return angular.isObject(b)&&angular.extend(c,b),c.id=c.id||this.guid.create("p"),delete c.$$hashKey,this.initPlayer(c,a),c},a.prototype.initPlayer=function(a,b){a._tournament=b},a.prototype.newEvent=function(a,b){var c={};return angular.isObject(b)&&angular.extend(c,b),c.id=c.id||this.guid.create("e"),delete c.$$hashKey,this.initEvent(c,a),c},a.prototype.initEvent=function(a,b){a._tournament=b;var c=a.draws=a.draws||[];if(c)for(var d=c.length-1;d>=0;d--){var e=c[d];this.drawLib.initDraw(e,a),e._previous=c[d-1],e._next=c[d+1]}},a.prototype.isRegistred=function(a,b){return b.registration&&-1!==b.registration.indexOf(a.id)},a.prototype.getRegistred=function(a){for(var b=[],c=a._tournament.players,d=0,e=c.length;e>d;d++){var f=c[d];this.isRegistred(a,f)&&b.push(f)}return b},a.prototype.TriJoueurs=function(a){var b=this,c=function(a,c){var d="number"==typeof a,e="number"==typeof c;return d&&e?0:d?-1:e?1:b.rank.compare(a.rank,c.rank)};a.sort(c);for(var d=0,e=1;d<a.length;e++)(e===a.length||c(a[d],a[e]))&&(tool.shuffle(a,d,e),d=e)},a.prototype.GetJoueursInscrit=function(a){for(var b=a._event._tournament.players,c=[],d=0,e=0;e<b.length;e++){var f=b[e];this.isRegistred(a._event,f)&&(!f.rank||this.rank.within(f.rank,a.minRank,a.maxRank))&&c.push(f)}return c},a.prototype.isSexeCompatible=function(a,b){return a.sexe===b||"M"===a.sexe&&!a.typeDouble},a}();a.TournamentLib=d,angular.module("jat.services.tournamentLib",["jat.services.drawLib","jat.services.type","jat.services.guid"]).factory("tournamentLib",["drawLib","rank","guid",function(a,b,c){return new d(a,b,c)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a._reindex=function(a,b){for(var c={_length:a.length},d=0;d<a.length;d++){var e=a[d],f=e[b];void 0!==f&&(c[f]=d)}a["_FindBy"+b]=c},a.prototype.indexOf=function(b,c,d,e){var f,g;if(null==d)return null;var h="_FindBy"+c;h in b||a._reindex(b,c);var i=b[h];if(d in i&&i._length===b.length?(f=i[d],g=b[f],g[c]!==d&&(a._reindex(b,c),g=b[h],f=g[d])):(a._reindex(b,c),g=b[h],f=g[d]),e&&void 0===f)throw e;return void 0!==f?f:-1},a.prototype.by=function(a,b,c,d){var e=this.indexOf(a,b,c,d);return a[e]},a.prototype.byId=function(a,b,c){var d=this.indexOf(a,"id",b,c);return a[d]},a}();a.Find=b,angular.module("jat.services.find",[]).service("find",b)}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.create=function(a){return(a||"")+Math.round(999*Math.random())},a}();a.Guid=b,angular.module("jat.services.guid",[]).service("guid",b)}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a){this.find=a}return a.prototype.select=function(a,b){if(!a)return void this.unselect(b);if(b===models.ModelType.Box||"_player"in a&&a._draw){var c=a;this.tournament=c._draw._event._tournament,this.event=c._draw._event,this.draw=c._draw,this.box=c}else if(b===models.ModelType.Draw||a._event){var d=a;this.tournament=d._event._tournament,this.event=d._event,this.draw=d,this.box=void 0}else if(b===models.ModelType.Event||a.draws&&a._tournament){var e=a;this.tournament=e._tournament,this.event=e,this.draw=e.draws?e.draws[0]:void 0,this.box=void 0}else if(b===models.ModelType.Player||a.name&&a._tournament){var f=a;this.tournament=f._tournament,this.player=f}else(b===models.ModelType.Tournament||a.players&&a.events)&&(this.tournament=a,this.tournament.events[0]?(this.event=this.tournament.events[0],this.draw=this.event&&this.event.draws?this.event.draws[this.event.draws.length-1]:void 0):(this.event=void 0,this.draw=void 0),this.box=void 0,this.player&&this.player._tournament!==this.tournament&&(this.player=void 0))},a.prototype.unselect=function(a){switch(a){case models.ModelType.Tournament:this.tournament=void 0,this.player=void 0;case models.ModelType.Event:this.event=void 0;case models.ModelType.Draw:this.draw=void 0;case models.ModelType.Box:this.box=void 0;break;case models.ModelType.Player:this.player=void 0}},a.prototype.selectByError=function(a,b){if(b.position){var c=this.find.by(a.boxes,"position",b.position);this.select(c,models.ModelType.Box)}else b.player?this.select(b.player,models.ModelType.Player):this.select(a,models.ModelType.Draw)},a}();a.Selection=b,angular.module("jat.services.selection",["jat.services.find"]).factory("selection",["find",function(a){return new b(a)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this.stack=[],this.head=-1,this.maxUndo=20}return a.prototype.reset=function(){this.stack=[],this.head=-1,this.group=null},a.prototype.action=function(b,c,d){if("function"!=typeof b)throw"Undo action: invalid fnAction";var e={type:a.ActionType.ACTION,fnAction:b,message:c||"",meta:d},f=b(!1);return this._pushAction(e),f},a.prototype.update=function(b,c,d,e,f){if("undefined"==typeof b)throw"Undo update: invalid obj";if("undefined"==typeof c)throw"Undo update: invalid member";if("undefined"==typeof d)throw"Undo update: invalid value";var g={type:a.ActionType.UPDATE,obj:b,member:c,value:b[c],message:e||"update",meta:f};if(b.splice&&("number"!=typeof c||0>c||b.length<=c))throw"Bad array position to update";b[c]=d,this._pushAction(g)},a.prototype.insert=function(b,c,d,e,f){if("undefined"==typeof b)throw"Undo insert: invalid obj";if("undefined"==typeof c)throw"Undo insert: invalid member";if("undefined"==typeof d)throw"Undo insert: invalid value";b.splice&&("number"!=typeof c||0>c||c>b.length)&&(c=b.length);var g={type:a.ActionType.INSERT,obj:b,member:c,value:void 0,message:e||(c===b.length?"append":"insert"),meta:f};b.splice?b.splice(c,0,d):b[c]=d,this._pushAction(g)},a.prototype.remove=function(b,c,d,e){if("undefined"==typeof b)throw"Undo remove: invalid obj";if("undefined"==typeof c)throw"Undo remove: invalid member";var f={type:a.ActionType.REMOVE,obj:b,member:c,value:b[c],message:d||"remove",meta:e};if(b.splice){if("number"!=typeof c||0>c||b.length<=c)throw"Bad array position to remove";b.splice(c,1)}else delete b[c];this._pushAction(f)},a.prototype.splice=function(b,c,d,e,f,g){if("undefined"==typeof b)throw"Undo splice: invalid obj";if("undefined"==typeof b.slice)throw"Undo splice: invalid obj not an array";if("number"!=typeof c)throw"Undo splice: invalid index";if(0>c||b.length<c)throw"Undo splice: bad array position to remove";var h={type:a.ActionType.SPLICE,obj:b,index:c,howmany:e.length,message:f||"splice",values:void 0,meta:g},i=e.slice(0,e.length);i.unshift(c,d),h.values=Array.prototype.splice.apply(b,i),this._pushAction(h)},a.prototype._pushAction=function(a){this.group?this.group.stack.push(a):(this.head++,this.stack.splice(this.head,this.stack.length,a),this._maxUndoOverflow())},a.prototype.newGroup=function(b,c,d){if(this.group)throw"Cannot imbricate group";this.group={type:a.ActionType.GROUP,stack:[],message:b||"",meta:d},"undefined"!=typeof c&&(c()?this.endGroup():this.cancelGroup())},a.prototype.endGroup=function(){if(!this.group)throw"No group defined";var a=this.group;this.group=null,a.stack.length&&this._pushAction(a)},a.prototype.cancelGroup=function(){if(!this.group)throw"No group defined";this._do(this.group,!0),this.group=null},a.prototype._do=function(b,c){if(this.meta=b.meta,b.type===a.ActionType.GROUP){var d;if(c)for(var e=b.stack.length-1;e>=0;e--)d=this._do(b.stack[e],!0);else for(e=0;e<b.stack.length;e++)d=this._do(b.stack[e],!1);return this.meta=b.meta,d}if(b.type===a.ActionType.ACTION)return b.fnAction(c);if(b.type===a.ActionType.UPDATE){var f=b.obj[b.member];return b.obj[b.member]=b.value,b.value=f,f}if(b.type===a.ActionType.SPLICE){var g=b.values.slice(0,b.values.length);return g.unshift(b.index,b.howmany),b.howmany=b.values.length,b.values=Array.prototype.splice.apply(b.obj,g),g[2]}return(c?b.type!==a.ActionType.INSERT:b.type!==a.ActionType.REMOVE)?b.obj.splice?(b.obj.splice(b.member,0,b.value),b.value):(b.obj[b.member]=b.value,b.value):(b.value=b.obj[b.member],void(b.obj.splice?b.obj.splice(b.member,1):delete b.obj[b.member]))},a.prototype.undo=function(){if(!this.canUndo())throw"Can't undo";var a=this._do(this.stack[this.head],!0);return this.head--,a},a.prototype.redo=function(){if(!this.canRedo())throw"Can't redo";return this.head++,this._do(this.stack[this.head],!1)},a.prototype.canUndo=function(){return 0<=this.head&&this.head<this.stack.length},a.prototype.canRedo=function(){return-1<=this.head&&this.head<this.stack.length-1},a.prototype.messageUndo=function(){return this.canUndo()?this.stack[this.head].message:""},a.prototype.messageRedo=function(){return this.canRedo()?this.stack[this.head+1].message:""},a.prototype.setMaxUndo=function(a){if("number"!=typeof a)throw"Invalid maxUndo value";this.maxUndo=a,this._maxUndoOverflow()},a.prototype._maxUndoOverflow=function(){if(this.stack.length>this.maxUndo){var a=this.stack.length-this.maxUndo;this.head-=a,this.stack.splice(0,a)}},a.prototype.getMeta=function(){return this.meta},a.prototype.toString=function(){return(this.group?"Grouping ("+this.group.message+"), ":"")+(this.canUndo()?this.head+1+" undo("+this.messageUndo()+")":"No undo")+", "+(this.canRedo()?this.stack.length-this.head+" redo("+this.messageRedo()+")":"No redo")+", maxUndo="+this.maxUndo},a.ActionType={UPDATE:1,INSERT:2,REMOVE:3,GROUP:4,ACTION:5,SPLICE:6},a}();a.Undo=b,angular.module("jat.services.undo",[]).service("undo",b)}(b=a.service||(a.service={}))}(jat||(jat={})),angular.module("jat.services",[]).value("version","0.1");var jat;!function(a){var b;!function(a){var b=function(){function a(a){this.find=a,this._validLibs=[],this._errorsDraw={},this._errorsPlayer={}}return a.prototype.addValidator=function(a){this._validLibs.push(a)},a.prototype.validatePlayer=function(a){for(var b=!0,c=0;c<this._validLibs.length;c++)b=b&&this._validLibs[c].validatePlayer(a);return b},a.prototype.validateDraw=function(a){for(var b=!0,c=0;c<this._validLibs.length;c++)b=b&&this._validLibs[c].validateDraw(a);return b},a.prototype.errorPlayer=function(a,b,c){var d=[];d.push("Validation error on",b.name),c&&d.push("("+c+")"),d.push(":",a),console.warn(d.join(" "));var e=this._errorsPlayer[b.id];e||(e=this._errorsPlayer[b.id]=[]),e.push({message:a,player:b,detail:c})},a.prototype.errorDraw=function(a,b,c,d){var e=[];e.push("Validation error on",b.name),c&&c._player&&e.push("for",c._player.name),d&&e.push("("+d+")"),e.push(":",a),console.warn(e.join(" "));var f=this._errorsDraw[b.id];f||(f=this._errorsDraw[b.id]=[]),f.push({message:a,player:c?c._player:void 0,position:c?c.position:void 0,detail:d})},a.prototype.hasErrorDraw=function(a){var b=a&&this._errorsDraw[a.id];return b&&b.length>0},a.prototype.hasErrorBox=function(a){var b=a&&this._errorsDraw[a._draw.id];if(b)var c=this.find.by(b,"position",a.position);return!!c},a.prototype.getErrorDraw=function(a){return a&&this._errorsDraw[a.id]},a.prototype.getErrorBox=function(a){var b=a&&this._errorsDraw[a._draw.id];return b?this.find.by(b,"position",a.position):void 0},a.prototype.resetPlayer=function(a){a?delete this._errorsPlayer[a.id]:this._errorsPlayer={}},a.prototype.resetDraw=function(a){a?delete this._errorsDraw[a.id]:this._errorsDraw={}},a}();a.Validation=b,angular.module("jat.services.validation",["jat.services.find"]).factory("validation",["find",function(a){return new b(a)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var polyfill;!function(a){"console"in window||(window.console={info:angular.noop,log:angular.noop,warn:angular.noop,error:angular.noop}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(1/0===Math.abs(f)&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){var g;if(c in d&&d[c]===a)return c;c++}return-1})}(polyfill||(polyfill={}));var tool;!function(a){function b(a,c){if(c){if(a===c)throw Error("Can't copy equivalent objects or arrays");if(angular.isArray(a)){c.length=0;for(var d=0;d<a.length;d++)c.push(b(a[d]))}else for(var e in a)a.hasOwnProperty(e)&&-1=="_$".indexOf(e.charAt(0))&&(c[e]=b(a[e]))}else c=a,a&&(angular.isArray(a)?c=b(a,[]):angular.isDate(a)?c=new Date(a.getTime()):angular.isObject(a)&&(c=b(a,{})));return c}function c(a,b,c){b=b||0,arguments.length<3&&(c=a.length);var d=c-b;if(2==d){var e=a[0];a[0]=a[1],a[1]=e}else for(var f=c-1;f>b;f--){var g=b+Math.floor(d*Math.random()),e=a[g];a[g]=a[f],a[f]=e}return a}function d(a,b){for(var c=new Array(a),d=a-1;d>=0;d--)c[d]=0;return c}function e(a){if(a){for(var b={},c=a.length-1;c>=0;c--){var d=a[c];d.id&&(b[d.id]=d)}return b}}a.copy=b,a.shuffle=c,a.filledArray=d,a.hashById=e}(tool||(tool={})),angular.module("jat.utils.checkList",[]).directive("checkList",function(){return{scope:{list:"=checkList",value:"@"},link:function(a,b,c){function d(){var c=b.prop("checked");a.list||(a.list=[]);var d=a.list.indexOf(a.value);c&&-1==d?a.list.push(a.value):c||-1==d||a.list.splice(d,1)}a.$watch("list",function(c){if(c){var d=c.indexOf(a.value);b.prop("checked",-1!=d)}},!0),b.bind("change",function(){a.$apply(d)})}}});var ec;!function(a){var b;!function(a){function b(){return{restrict:"EA",templateUrl:"template/inputFile.html",transclude:!0,scope:{onloaded:"&"},link:function a(b,c,d){c.css({position:"relative"}),c.find("input").on("change",function(a){b.onloaded({file:a.target.files[0]})})}}}function c(a){a.put("template/inputFile.html","<input type='file' accept='application/json,text/plain' style='position: relative; text-align: right; -webkit-opacity:0; -moz-opacity:0; filter: alpha(opacity: 0); opacity: 0; z-index: 2; width: 80px;'><button style='position:absolute; left:0px; width:100%; z-index:1;' class='btn' ng-transclude></button>")
}angular.module("ec.inputFile",[]).directive("ecInputFile",b).run(["$templateCache",c])}(b=a.ui||(a.ui={}))}(ec||(ec={}));var ec;!function(a){var b;!function(a){function b(){return{restrict:"EA",transclude:!0,replace:!0,scope:{},controller:"PanelsetController",templateUrl:"template/panels/panelset.html"}}function c(){return{require:"^ecPanelset",restrict:"EA",replace:!0,templateUrl:"template/panels/panel.html",transclude:!0,scope:{isOpen:"=?",isDisabled:"=?"},controller:"PanelController",link:function a(b,c,d,e){e.addPanel(b),b.$watch("isOpen",function(a){return e.select(b,!!a)}),b.toggleOpen=function(){b.isDisabled||(b.isOpen=!b.isOpen)},b.getWidth=function(){return e.selectCount?Math.floor(100/e.selectCount)+"%":"auto"}}}}function d(){return{require:"^ecPanelset",restrict:"EA",replace:!0,templateUrl:"template/panels/badge.html",transclude:!0,scope:{},link:function a(b,c,d,e){b.panel=null,e.addBadge(b)}}}function e(){return{require:"^ecPanel",restrict:"EA",replace:!0,templateUrl:"template/panels/header.html",transclude:!0,link:function a(b,c,d,e){b.panel=e.scope}}}function f(a){a.put("template/panels/panelset.html","<div class='panels' ng-transclude></div>"),a.put("template/panels/badge.html","<div class='panelbadge' ng-class='{active: panel.isOpen, disabled: panel.isDisabled}' ng-style=\"{'margin-left': (panel.marginLeft) * 3 +'em'}\" ng-click='panel.toggleOpen()' ng-dblclick='panel.toggleOpen(true)' ng-transclude></div>"),a.put("template/panels/panel.html","<div class='panel' ng-class='{active: isOpen, disabled: isDisabled}' ng-style=\"{'width': isOpen ? getWidth() : 0}\" ng-transclude></div>"),a.put("template/panels/header.html","<div class='header' ng-style=\"{'margin-left': (1 + panel.marginLeft) * 3 +'em'}\" ng-transclude></div>")}var g=function(){function a(){this.panels=[],this.badges=[],this.selectCount=0}return a.prototype.select=function(a,b){this.selectCount=0;for(var c=0;c<this.panels.length;c++)if(this.panels[c].marginLeft=c,this.panels[c].isOpen){this.selectCount++;break}var d=c,e=0;for(c=this.panels.length-1;c>d;c--)this.panels[c].isOpen?(this.selectCount++,e=0):e--,this.panels[c].marginLeft=e},a.prototype.addBadge=function(a){var b=this;this.badges.push(a),a.$on("$destroy",function(){return b.removeBadge(a)})},a.prototype.addPanel=function(a){var b=this,c=this.badges[this.panels.length];c.panel=a,a.badge=c,a.marginLeft=0,this.panels.push(a),a.isOpen&&this.selectCount++,a.$on("$destroy",function(){return b.removePanel(a)})},a.prototype.removePanel=function(a){var b=this.panels.indexOf(a);a.isOpen&&this.selectCount--,a.badge&&delete a.badge.panel,this.panels.splice(b,1)},a.prototype.removeBadge=function(a){var b=this.badges.indexOf(a);a.panel&&delete a.panel.badge,this.badges.splice(b,1)},a}(),h=function(){function a(a){this.scope=a}return a.$inject=["$scope"],a}();angular.module("ec.panels",[]).controller("PanelsetController",g).controller("PanelController",h).directive("ecPanelset",b).directive("ecPanel",c).directive("ecBadge",d).directive("ecHeader",e).run(["$templateCache",f])}(b=a.ui||(a.ui={}))}(ec||(ec={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e,f,g){var h=this;this.title=a,this.draw=b,this.rank=c,this.drawLib=e,this.tournamentLib=f,this.drawTypes=[];for(var i=0;4>i;i++)this.drawTypes[i]={value:i,label:models.DrawType[i]};this.ranks=c.list(),this.categories=d.list(),g.$watch("dlg.draw.minRank",function(a){(!h.draw.maxRank||h.rank.compare(a,h.draw.maxRank)>0)&&(h.draw.maxRank=a)}),g.$watch("dlg.draw.maxRank",function(a){a&&h.draw.minRank&&h.rank.compare(h.draw.minRank,a)>0&&(h.draw.minRank=a)})}return a.prototype.getRegisteredCount=function(){var a=this.tournamentLib.GetJoueursInscrit(this.draw).length,b=this.drawLib.previousGroup(this.draw);if(b){var c=this.drawLib.findAllPlayerOut(b);c&&(a+=c.length)}return a},a.$inject=["title","draw","rank","category","drawLib","tournamentLib","$scope"],a}();angular.module("jat.draw.dialog",[]).controller("dialogDrawCtrl",b)}(b=a.draw||(a.draw={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e){this.title=a,this.match=b;var f=b._draw._event._tournament,g=d.boxesOpponents(b);this.player1=c.byId(f.players,g.box1.playerId),this.player2=c.byId(f.players,g.box2.playerId),this.places=f.places,this.matchFormats=e.list()}return a.$inject=["title","match","find","drawLib","matchFormat"],a}();angular.module("jat.match.dialog",["jat.services.drawLib","jat.services.find","jat.services.type"]).controller("dialogMatchCtrl",b)}(b=a.match||(a.match={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return{restrict:"EA",scope:!0,templateUrl:"views/draw/drawBox.html",controller:d,controllerAs:"ctrlBox",link:function(b,d,e,f){b.$watch(e.drawBox,function(b){f.box=b,f.isMatch=c(b),f.error=a.getErrorBox(b)})}}}function c(a){return a&&"score"in a}var d=function(){function a(){}return a.prototype.isPlayed=function(){return this.isMatch&&!!this.box.score},a}();angular.module("jat.draw.box",["jat.services.find"]).directive("drawBox",["validation",b])}(b=a.draw||(a.draw={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return{pos1:(a<<1)+2,pos2:(a<<1)+1}}function c(){return{restrict:"EA",scope:!0,templateUrl:"views/draw/drawDraw.html",controller:f,controllerAs:"ctrlDraw",link:function(a,b,c,d){var e=function(e,f){d.draw=e,d.isKnockout=e&&e.type<2,d.boxWidth=a.$eval(c.boxWidth)||150,d.boxHeight=a.$eval(c.boxHeight)||40,d.interBoxWidth=a.$eval(c.interBoxWidth)||10,d.interBoxHeight=a.$eval(c.interBoxHeight)||10,d.simple=a.$eval(c.simple),d.init(),d.computeCoordinates(),d.isKnockout&&g&&d.drawLines(b)};a.$watch(c.draw,e),a.$watch(c.draw+"._refresh",function(a,b){a!==b&&e(d.draw)})}}}function d(){g&&(h=function(a,b,c){this._width=b,this._height=c,this.beginPath(),this._element=a,this._element.find("shape").remove()},h.prototype={_path:[],_tx:0,_ty:0,translate:function(a,b){},beginPath:function(){this._path.length=0,this.lineWidth=1,this.strokeStyle="black"},moveTo:function(a,b){this._path.push("m",this._tx+a,",",this._ty+b)},lineTo:function(a,b){this._path.push("l",this._tx+a,",",this._ty+b)},stroke:function(){},done:function(){var a=angular.element('<v:shape coordsize="'+this._width+" "+this._height+'" style="position:absolute; left:0px; top:0px; width:'+this._width+"px; height:"+this._height+'px;" filled="0" stroked="1" strokecolor="'+this.strokeStyle+'" strokeweight="'+this.lineWidth+'px" path="'+this._path.join("")+'" />');this._element.append(a)}})}function e(){return{restrict:"A",require:"^draw",link:function(a,b,c,d){a.$watch(c.drawLines,function(){d.drawLines(b)})}}}var f=function(){function a(a,b,c,d,e){this.drawLib=a,this.tournamentLib=b,this.find=c,this.undo=d,this.selection=e,this.boxWidth=150,this.boxHeight=40,this.interBoxWidth=10,this.interBoxHeight=10,this.simple=!1}return a.prototype.init=function(){if(this.draw&&!this.simple){this.players=this.tournamentLib.GetJoueursInscrit(this.draw);var a=this.drawLib.previousGroup(this.draw);this.qualifsIn=a?this.drawLib.findAllPlayerOutBox(a):void 0,this.qualifsOut=[];for(var b=1;b<=this.draw.nbOut;b++)this.qualifsOut.push(b)}},a.prototype.computeCoordinates=function(){if(this.draw){var a=this.draw,b=this.drawLib.getSize(a);if(this.width=b.width*this.boxWidth-this.interBoxWidth,this.height=b.height*this.boxHeight,a._points=this.drawLib.computePositions(a),this._refresh=new Date,!this.isKnockout){var c=a.nbColumn;this.rows=new Array(c);for(var d=0;c>d;d++){for(var e=new Array(c+1),f=(c+1)*c-d-1,g=0;c>=g;g++)e[g]=f,f-=c;this.rows[d]=e}}}},a.prototype.drawLines=function(a){a.attr("width",this.width).attr("height",this.height);var c=this.draw;if(c&&c.boxes&&c.boxes.length&&!(2<=c.type)){var d=a[0],e=g?new h(a,this.width,this.height):d.getContext("2d");e.lineWidth=.5,e.translate(.5,.5);for(var f=this.boxHeight>>1,i=c.boxes.length-1;i>=0;i--){var j=c.boxes[i],k=j._x*this.boxWidth,l=j._y*this.boxHeight;if(this.isMatch(j)){var m=b(j.position),n=c._points[m.pos1],o=c._points[m.pos2];n&&o&&(e.moveTo(k-this.interBoxWidth,n.y*this.boxHeight+f),e.lineTo(k,l+f),e.lineTo(k-this.interBoxWidth,o.y*this.boxHeight+f),e.stroke())}e.moveTo(k,l+f),e.lineTo(k+this.boxWidth-this.interBoxWidth,l+f),e.stroke()}e.done&&e.done()}},a.prototype.getBox=function(a){return this.draw&&this.draw.boxes?this.find.by(this.draw.boxes,"position",a):void 0},a.prototype.isDiag=function(a){if(this.draw){var b=this.draw.nbColumn;return a%b*(b+1)===a}},a.prototype.range=function(a,b,c){c=c||1;for(var d=[],e=a;b>=e;e+=c)d.push(e);return d},a.prototype.getQualifsIn=function(){return this.qualifsIn},a.prototype.getQualifsOut=function(){return this.qualifsOut},a.prototype.getPlayers=function(){return this.players},a.prototype.findQualifIn=function(a){return this.draw&&!!this.find.by(this.draw.boxes,"qualifIn",a)},a.prototype.findPlayer=function(a){return this.draw&&a&&!!this.find.by(this.draw.boxes,"playerId",a)},a.prototype.setPlayer=function(a,b,c){var d=this,e=a._player,f=a.qualifIn;this.undo.action(function(g){f||c?d.drawLib.setPlayerIn(a,g?f:c,g?e:b):(a.playerId=g?e?e.id:void 0:b?b.id:void 0,d.drawLib.initBox(a,a._draw)),d.selection.select(a,models.ModelType.Box)},b?"Set player":"Erase player")},a.prototype.swapPlayer=function(a){},a.prototype.eraseScore=function(a){var b=this;this.undo.newGroup("Erase score",function(){return b.undo.update(a,"score",""),!0},a)},a.prototype.isMatch=function(a){return a&&"score"in a},a.$inject=["drawLib","tournamentLib","find","undo","selection"],a}(),g=!window.HTMLCanvasElement,h;angular.module("jat.draw.list",["jat.services.drawLib","jat.services.knockout","jat.services.roundrobin","jat.services.tournamentLib","jat.services.find","jat.services.undo","jat.services.selection"]).directive("draw",c).directive("drawLines",e).run(d)}(b=a.draw||(a.draw={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e,f){this.selection=a,this.title=b,this.event=c,this.tournamentLib=d,this.ranks=e.list(),this.categories=f.list(),this.registred=d.getRegistred(c)}return a.$inject=["selection","title","event","tournamentLib","rank","category"],a}();angular.module("jat.event.dialog",[]).controller("dialogEventCtrl",b)}(b=a.event||(a.event={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(){var a={templateUrl:"views/event/listEvents.html",controller:"listEventsCtrl",controllerAs:"list",restrict:"EA",scope:!0,link:function(a,b,c,d){a.$watch(c.listEvents,function(a,b,c){d.events=a})}};return a}var c=function(){function a(){}return a}();angular.module("jat.event.list",[]).directive("listEvents",b).controller("listEventsCtrl",c)}(b=a.event||(a.event={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(){var a={templateUrl:"views/main.html",controller:"mainCtrl",controllerAs:"main",restrict:"EA"};return a}var c=function(){function a(a,b,c,d,e,f,g,h,i){var j=this;this.$modal=a,this.selection=b,this.mainLib=c,this.tournamentLib=d,this.drawLib=e,this.validation=f,this.undo=g,this.$window=h,this.$timeout=i,this.GenerateType=models.GenerateType,this.ModelType=models.ModelType,this.Mode=models.Mode,this.selection.tournament=this.tournamentLib.newTournament();var k="/data/tournament8.json";this.mainLib.loadTournament(k).then(function(a){});var l=function(a){j.mainLib.saveTournament(j.selection.tournament)};h.addEventListener?h.addEventListener("beforeunload",l):h.onbeforeunload=l}return a.prototype.newTournament=function(){this.mainLib.newTournament(),this.editTournament(this.selection.tournament)},a.prototype.loadTournament=function(a){this.mainLib.loadTournament(a)},a.prototype.saveTournament=function(){this.mainLib.saveTournament(this.selection.tournament,"")},a.prototype.editTournament=function(a){var b=this,c=this.tournamentLib.newInfo(this.selection.tournament.info);this.$modal.open({templateUrl:"views/tournament/dialogInfo.html",controller:"dialogInfoCtrl as dlg",resolve:{title:function(){return"Edit info"},info:function(){return c}}}).result.then(function(a){if("Ok"===a){var d=b.selection.tournament;b.undo.update(b.selection.tournament,"info",c,"Edit info")}})},a.prototype.select=function(a,b){var c=this;return a&&b?(this.selection.unselect(b),void this.$timeout(function(){return c.selection.select(a,b)},0)):void this.selection.select(a,b)},a.prototype.addPlayer=function(){var a=this,b=this.tournamentLib.newPlayer(this.selection.tournament);this.$modal.open({templateUrl:"views/player/dialogPlayer.html",controller:"dialogPlayerCtrl as dlg",resolve:{title:function(){return"New player"},player:function(){return b},events:function(){return a.selection.tournament.events}}}).result.then(function(c){"Ok"===c&&a.mainLib.addPlayer(a.selection.tournament,b)})},a.prototype.editPlayer=function(a){var b=this,c=this.tournamentLib.newPlayer(this.selection.tournament,a);this.$modal.open({templateUrl:"views/player/dialogPlayer.html",controller:"dialogPlayerCtrl as dlg",resolve:{title:function(){return"Edit player"},player:function(){return c},events:function(){return b.selection.tournament.events}}}).result.then(function(d){"Ok"===d?b.mainLib.editPlayer(c,a):"Del"===d&&b.mainLib.removePlayer(a)})},a.prototype.removePlayer=function(a){this.mainLib.removePlayer(a)},a.prototype.addEvent=function(a){var b=this,c=this.tournamentLib.newEvent(this.selection.tournament);this.$modal.open({templateUrl:"views/event/dialogEvent.html",controller:"dialogEventCtrl as dlg",resolve:{title:function(){return"New event"},event:function(){return c}}}).result.then(function(d){"Ok"===d&&b.mainLib.addEvent(b.selection.tournament,c,a)})},a.prototype.editEvent=function(a){var b=this,c=this.tournamentLib.newEvent(this.selection.tournament,a);this.$modal.open({templateUrl:"views/event/dialogEvent.html",controller:"dialogEventCtrl as dlg",resolve:{title:function(){return"Edit event"},event:function(){return c}}}).result.then(function(d){"Ok"===d?b.mainLib.editEvent(c,a):"Del"===d&&b.mainLib.removeEvent(a)})},a.prototype.removeEvent=function(a){this.mainLib.removeEvent(a)},a.prototype.addDraw=function(a){var b=this,c=this.drawLib.newDraw(this.selection.event,void 0,a);this.$modal.open({templateUrl:"views/draw/dialogDraw.html",controller:"dialogDrawCtrl as dlg",resolve:{title:function(){return"New draw"},draw:function(){return c}}}).result.then(function(d){"Ok"===d?b.mainLib.addDraw(c,0,a):"Generate"===d&&b.mainLib.addDraw(c,1,a)})},a.prototype.editDraw=function(a){var b=this,c=this.drawLib.newDraw(a._event,a);this.$modal.open({templateUrl:"views/draw/dialogDraw.html",controller:"dialogDrawCtrl as dlg",resolve:{title:function(){return"Edit draw"},draw:function(){return c}}}).result.then(function(d){"Ok"===d?b.mainLib.updateDraw(c,a):"Generate"===d?b.mainLib.updateDraw(c,a,1):"Del"===d&&b.mainLib.removeDraw(a)})},a.prototype.validateDraw=function(a){this.mainLib.validateDraw(a)},a.prototype.generateDraw=function(a,b){this.mainLib.updateDraw(a,void 0,b||models.GenerateType.Create)},a.prototype.updateQualif=function(a){this.mainLib.updateQualif(a)},a.prototype.removeDraw=function(a){this.mainLib.removeDraw(a)},a.prototype.isMatch=function(a){return a&&"score"in a},a.prototype.editMatch=function(a){var b=this,c=this.drawLib.newBox(a._draw,a);this.$modal.open({templateUrl:"views/draw/dialogMatch.html",controller:"dialogMatchCtrl as dlg",resolve:{title:function(){return"Edit match"},match:function(){return c}}}).result.then(function(d){"Ok"===d&&b.mainLib.editMatch(c,a)})},a.prototype.doUndo=function(){this.selection.select(this.undo.undo(),this.undo.getMeta())},a.prototype.doRedo=function(){this.selection.select(this.undo.redo(),this.undo.getMeta())},a.$inject=["$modal","selection","mainLib","tournamentLib","drawLib","validation","undo","$window","$timeout"],a}();a.mainCtrl=c,angular.module("jat.main",["jat.services.mainLib","jat.services.selection","jat.services.undo","jat.services.tournamentLib","jat.services.drawLib","jat.services.knockout","jat.services.roundrobin","jat.services.validation","jat.services.validation.knockout","jat.services.validation.roundrobin","jat.services.validation.fft","jat.tournament.dialog","jat.player.dialog","jat.player.list","jat.event.dialog","jat.event.list","jat.draw.dialog","jat.draw.list","jat.draw.box","jat.match.dialog","ec.panels","ec.inputFile","ui.bootstrap"]).directive("main",b).controller("mainCtrl",c)}(b=a.main||(a.main={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e){this.title=a,this.player=b,this.events=c,this.ranks=d.list(),this.categories=e.list()}return a.$inject=["title","player","events","rank","category"],a}();a.dialogPlayerCtrl=b,angular.module("jat.player.dialog",["jat.utils.checkList"]).controller("dialogPlayerCtrl",b)}(b=a.player||(a.player={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(){var a={templateUrl:"views/player/listPlayers.html",controller:"listPlayersCtrl",controllerAs:"list",restrict:"EA",scope:!0,link:function(a,b,c,d){a.$watch(c.listPlayers,function(a,b,c){d.players=a})}};return a}var c=function(){function a(a,b){this.selection=a,this.find=b}return a.prototype.eventById=function(a){return this.selection.tournament&&this.selection.tournament.events?this.find.byId(this.selection.tournament.events,a):void 0},a.$inject=["selection","find"],a}();angular.module("jat.player.list",["jat.services.selection","jat.services.find"]).directive("listPlayers",b).controller("listPlayersCtrl",c)}(b=a.player||(a.player={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b){this.title=a,this.info=b}return a.$inject=["title","info"],a}();angular.module("jat.tournament.dialog",[]).controller("dialogInfoCtrl",b)}(b=a.tournament||(a.tournament={}))}(jat||(jat={}));
//# sourceMappingURL=jatennis.min.js.map