"use strict";angular.module("jat",["ui.bootstrap","ui.bootstrap.modal","jat.services.selection","jat.services.find","jat.services.undo","jat.services.type","jat.main"]).constant("appName","JA-Tennis").constant("appVersion","0.1").directive("appVersion",["appName","appVersion",function(a,b){return{template:a+" v"+b}}]);var models;!function(a){!function(a){a[a.Normal=0]="Normal",a[a.Final=1]="Final",a[a.PouleSimple=2]="PouleSimple",a[a.PouleAR=3]="PouleAR"}(a.DrawType||(a.DrawType={}));var b=a.DrawType;!function(a){a[a.None=0]="None",a[a.Create=1]="Create",a[a.PlusEchelonne=2]="PlusEchelonne",a[a.PlusEnLigne=3]="PlusEnLigne",a[a.Mix=4]="Mix"}(a.GenerateType||(a.GenerateType={}));var c=a.GenerateType;!function(a){a[a.None=0]="None",a[a.Tournament=1]="Tournament",a[a.Player=2]="Player",a[a.Event=3]="Event",a[a.Draw=4]="Draw",a[a.Match=5]="Match",a[a.Box=6]="Box"}(a.ModelType||(a.ModelType={}));var d=a.ModelType;!function(a){a[a.Build=0]="Build",a[a.Plan=1]="Plan",a[a.Play=2]="Play",a[a.Lock=3]="Lock"}(a.Mode||(a.Mode={}));var e=a.Mode}(models||(models={}));var jat;!function(a){var b;!function(a){function b(a){return a&&"score"in a}function c(a){return a.type===models.DrawType.PouleSimple||a.type===models.DrawType.PouleAR}function d(a){var b=a._draw;return c(a._draw)?a.position%b.nbColumn*(b.nbColumn+1):a.position}function e(a){return c(a._draw)?a.position>=a._draw.nbColumn*a._draw.nbColumn:!1}function f(a){if(c(a._draw)){var b=a._draw.nbColumn;return a.position%b+b*b}return(a.position<<1)+2}function g(a){if(c(a._draw)){var b=a._draw.nbColumn;return Math.floor(a.position/b)+b*b}return(a.position<<1)+1}function h(a,b){if(!a)throw b||"Assertion is false"}var i=32,j=32,k=-1,l=function(){function a(a,b,c){this.find=a,this.rank=b,this.guid=c,this._drawLibs={}}return a.prototype.newDraw=function(a,b,c){var d={};return angular.isObject(b)&&angular.extend(d,b),d.id=d.id||this.guid.create("d"),delete d.$$hashKey,d.type=d.type||models.DrawType.Normal,d.nbColumn=d.nbColumn||3,d.nbOut=d.nbOut||1,c&&(d._previous=c),d.minRank||(d.minRank=c&&c.maxRank?this.rank.next(c.maxRank):"NC"),d.maxRank&&this.rank.compare(d.minRank,d.maxRank)>0&&(d.maxRank=d.minRank),d._event=a,d},a.prototype.initDraw=function(a,b){if(a._event=b,a.type=a.type||0,a.nbColumn=a.nbColumn||0,a.nbOut=a.nbOut||0,a.boxes)for(var c=a.boxes.length-1;c>=0;c--){var d=a.boxes[c];this.initBox(d,a)}},a.prototype.resetDraw=function(a,b){var c=this.nextGroup(a);if(c&&a.boxes)for(var d=0;d<c.length;d++){var e=c[d].boxes;if(e)for(var f=0;f<e.length;f++){var g=e[f];g&&g.qualifOut&&this.SetQualifieSortant(g)}}a.boxes=[],a.nbColumn=this._drawLibs[a.type].nbColumnForPlayers(a,b)},a.prototype.newBox=function(a,b,c){var d={};if(angular.isObject(b))angular.extend(d,b);else if(angular.isString(b)){var e=d;e.score=void 0,e.matchFormat=b}return angular.isNumber(c)&&(d.position=c),this.initBox(d,a),d},a.prototype.initBox=function(a,b){a._draw=b,a._player=this.getPlayer(a)},a.prototype.nbColumnForPlayers=function(a,b){return this._drawLibs[a.type].nbColumnForPlayers(a,b)},a.prototype.getSize=function(a){return this._drawLibs[a.type].getSize(a)},a.prototype.computePositions=function(a){return this._drawLibs[a.type].computePositions(a)},a.prototype.resize=function(a,b,c){this._drawLibs[a.type].resize(a,b,c)},a.prototype.generateDraw=function(a,b,c){return this._drawLibs[a.type].generateDraw(a,b,c)},a.prototype.refresh=function(a){a._refresh=new Date},a.prototype.updateQualif=function(a){for(var b=[],c=a.boxes.length-1;c>=0;c--){var d=a.boxes[c];d.qualifIn&&b.push(d)}for(tool.shuffle(b),c=b.length-1;c>=0;c--)this.SetQualifieEntrant(b[c],0);for(c=b.length-1;c>=0;c--)this.SetQualifieEntrant(b[c],c+1)},a.prototype.getPlayer=function(a){return this.find.byId(a._draw._event._tournament.players,a.playerId)},a.prototype.groupBegin=function(a){for(var b=a;b&&b.suite&&b._previous;)b=b._previous;return b},a.prototype.groupEnd=function(a){for(var b=this.groupBegin(a);b&&b._next&&b._next.suite;)b=b._next;return b},a.prototype.group=function(a){for(var b=[],c=this.groupBegin(a);c&&(b.push(c),c=c._next,!c||c.suite););return b},a.prototype.previousGroup=function(a){var b=this.groupBegin(a);return b&&b._previous?this.group(b._previous):null},a.prototype.nextGroup=function(a){var b=this.groupEnd(a);return b&&b._next?this.group(b._next):null},a.prototype.isCreneau=function(a){return a&&"score"in a&&(a.place||a.date)},a.prototype.FindTeteSerie=function(a,b){h(b>=1&&i>=b);for(var c=angular.isArray(a)?a:this.group(a),d=0;d<c.length;d++)for(var e=c[d].boxes,f=0;f<e.length;f++){var g=e[f];if(g.seeded===b)return g}return null},a.prototype.FindQualifieEntrant=function(a,b){h(b>=1&&j>=b);for(var c=angular.isArray(a)?a:this.group(a),d=0;d<c.length;d++){var e=c[d],f=this._drawLibs[e.type].FindQualifieEntrant(e,b);if(f)return f}},a.prototype.FindQualifieSortant=function(a,b){h(b>=1&&j>=b);for(var c=angular.isArray(a)?a:this.group(a),d=0;d<c.length;d++){var e=c[d],f=this._drawLibs[e.type].FindQualifieSortant(e,b);if(f)return f}for(var g=0,d=0;d<c.length;d++){var e=c[d];e.type>=2&&(g+=e.nbOut)}return g>=b?-2:null},a.prototype.FindAllQualifieSortant=function(a,b){var c=angular.isArray(a)?a:this.group(a);if(c){for(var d=[],e=1;j>=e;e++)this.FindQualifieSortant(c,e)&&d.push(b?k:e);return d}},a.prototype.FindAllQualifieSortantBox=function(a){var b=angular.isArray(a)?a:this.group(a);if(b){for(var c=[],d,e=1;j>=e;e++)(d=this.FindQualifieSortant(b,e))&&c.push(d);return c}},a.prototype.SetQualifieEntrant=function(a,b,c){return this._drawLibs[a._draw.type].SetQualifieEntrant(a,b,c)},a.prototype.SetQualifieSortant=function(a,b){return this._drawLibs[a._draw.type].SetQualifieSortant(a,b)},a.prototype.CalculeScore=function(a){return this._drawLibs[a.type].CalculeScore(a)},a.prototype.MetJoueur=function(a,c,d){if(a.playerId!==c.id&&a.playerId&&!this.EnleveJoueur(a))throw"Error";var f=a,g=b(a)?a:void 0;a.playerId=c.id,a._player=c,e(a)||g&&(g.date=void 0,g.place=void 0);var h=a;if(h.qualifOut){var i=this.nextGroup(a._draw);if(i){var f=this.FindQualifieEntrant(i,h.qualifOut);if(f&&!f.playerId&&!this.MetJoueur(f,c,!0))throw"Error"}}return!0},a.prototype.SetResultat=function(a,b){if(b.playerId){if(!this.MetJoueur(a,b._player))throw"Error"}else if(!this.EnleveJoueur(a))throw"Error";return a.score=b.score,this.CalculeScore(a._draw),!0},a.prototype.MetCreneau=function(a,c){return h(b(a)),a.place=c.place,a.date=c.date,!0},a.prototype.EnleveCreneau=function(a){return h(b(a)),a.place=void 0,a.date=void 0,!0},a.prototype.MetPointage=function(a,b){return!0},a.prototype.EnleveJoueur=function(a,c){var d=a;if(!d.playerId&&!d.score)return!0;var e=this.nextGroup(a._draw),f=a,g;if((g=f.qualifOut)&&e){var h=this.FindQualifieEntrant(e,g);if(h&&!this.EnleveJoueur(h,!0))throw"Error"}a.playerId=a._player=void 0,b(a)&&(d.score="");var h=a;return!0},a.prototype.LockBoite=function(a){if(h(!!a),d(a)===a.position,h(!!a),a.hidden)return!0;a.locked=!0;var b=this.previousGroup(a._draw);if(b){var c=a;if(c.qualifIn){var e=this.FindQualifieSortant(b,c.qualifIn);e&&(e.locked=!0)}}return!0},a.prototype.DelockBoite=function(a){if(a.hidden)return!0;delete a.locked;var b=this.previousGroup(a._draw);if(b){var c=a;if(c.qualifIn){var d=this.FindQualifieSortant(b,c.qualifIn);d&&delete d.locked}}return!0},a.prototype.RempliBoite=function(a,d){var e=a,f=d,g=b(a)?a:void 0,h=b(d)?d:void 0;if(e.qualifIn&&e.qualifIn!=f.qualifIn){if(!this.SetQualifieEntrant(a))throw"Error"}else{if(!this.EnleveJoueur(a))throw"Error";if(delete e.qualifIn,delete e.seeded,delete g.qualifOut,this.isCreneau(g)&&!this.EnleveCreneau(g))throw"Error"}if(f.qualifIn){if(!this.SetQualifieEntrant(a,f.qualifIn,d._player))throw"Error"}else{if(d.playerId){if(!this.MetJoueur(a,d._player))throw"Error";g&&(g.score=h.score)}if(!c(a._draw)&&f.seeded&&(e.seeded=f.seeded),g){if(h.qualifOut&&!this.SetQualifieSortant(g,h.qualifOut))throw"Error";var i=this.boxesOpponents(g);if(i.box1&&i.box2&&(h.place||h.date)&&!this.MetCreneau(g,h))throw"Error";if(!this.MetPointage(a,d))throw"Error";g.matchFormat=h.matchFormat,g.note=g.note}}return this.CalculeScore(a._draw),!0},a.prototype.DeplaceJoueur=function(a,b,c){if(b=this.newBox(a._draw,b),!this.RempliBoite(b,c))throw"Error";if(!this.RempliBoite(a,b))throw"Error";return!0},a.prototype.boxesOpponents=function(a){return this._drawLibs[a._draw.type].boxesOpponents(a)},a}();a.DrawLib=l,angular.module("jat.services.drawLib",["jat.services.find","jat.services.type","jat.services.guid"]).factory("drawLib",["find","rank","guid",function(a,b,c){return new l(a,b,c)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a,b){if(!a)throw b||"Assertion is false"}function c(a){var b=-1;for(a++;a;a>>=1,b++);return b}function d(a,b){return b&&1!==b?c(b-2)+a:a-1}function e(a){return a&&1!==a?c(a-2)+1:0}function f(a){return(1<<a+1)-2}function g(a,b){return b&&1!==b?f(a)-h(a,b)+1:(1<<a)-1}function h(a,b){return b&&1!==b?b*h(a-e(b),1):1<<a}function i(a){return a&&1!==a?g(e(a),a):0}function j(a,b){return b&&1!==b?f(d(a,b)):(1<<a)-2}function k(a){return a-1>>1}function l(a){return 1&a?a+1:a-1}function m(a){return(a<<1)+2}function n(a){return(a<<1)+1}function o(a,b){return a+b*q(p(a+1))}function p(a){b(a>0);for(var c=a,d=-1;c;c>>=1,d++);return d}function q(a){return 1<<a}function r(a,d){if(b(d>=1&&d<=h(c(a))),c(a)===e(d))return d===1<<c(d-1)?0===a?1:r(a,1):1+t(a,d);var g=r(k(a),d),i,j,l;return j=d==1<<c(d-1)?a:u(a,d),i=!!(1&j),(l=c(j))>1&&j>f(l)-(h(l,d)>>1)&&(i=!i),i?g:1+h(c(a),d)-g}function s(a,d){return b(d>=1&&d<=h(c(a))),r(a,d)-1+h(c(a),d)-d}function t(a,d){b(d>=1&&d<=h(c(a)));var f=c(a);return Math.floor((a-g(f,d))/h(f-e(d)))}function u(a,d){b(d>=1&&d<=h(c(a)));var f=c(a);return a-t(a,d)*h(f-e(d))-g(f,d)+g(f-e(d))}function v(a,d){if(b(d>=1&&d<=h(c(a))),c(a)===e(d))return d===1<<c(d-1)?0==a?1:v(a,1):1+x(a,d);var g=v(k(a),d),i,j,l;return j=d===1<<c(d-1)?a:y(a,d),i=!!(1&j),(l=c(j))>1&&j<=f(l)-(h(l)>>1)&&(i=!i),i?1+h(c(a),d)-g:g}function w(a,d){return b(d>=1&&d<=h(c(a))),v(a,d)-1+h(c(a),d)-d}function x(a,d){b(d>=1&&d<=h(c(a)));var f=c(a);return d-1-Math.floor((a-g(f,d))/h(f-e(d)))}function y(a,d){b(d>=1&&d<=h(c(a)));var f=c(a);return a-(d-1-x(a,d))*h(f-e(d))-g(f,d)+g(f-e(d))}var z=0,A=9,B=32,C=-1,D=!0,E=function(){function a(a,b,c,d){this.drawLib=a,this.tournamentLib=b,this.rank=c,this.find=d,a._drawLibs[models.DrawType.Normal]=a._drawLibs[models.DrawType.Final]=this}return a.prototype.findBox=function(a,b,c){var d=this.find.by(a.boxes,"position",b);return!d&&c&&(d=this.drawLib.newBox(a,void 0,b)),d},a.prototype.nbColumnForPlayers=function(a,b){for(var c=e(a.nbOut),d=c+1;h(d,a.nbOut)<b&&A>d;d++);if(d>=A)throw"Max_COL is reached "+d;return d-c+1},a.prototype.resize=function(a,b,c){if(c&&(a.nbColumn=this.nbColumnForPlayers(a,c)),b&&a.nbOut!==b.nbOut){var e=d(a.nbColumn,a.nbOut)-d(b.nbColumn,b.nbOut);if(0!=e)for(var g=f(e),h=a.boxes.length-1;h>=0;h--){var i=a.boxes[h];i.position=o(i.position,g)}}},a.prototype.generateDraw=function(a,b,c){if(b===models.GenerateType.Create){var d=tool.filledArray(A,0),e=this.tournamentLib.GetJoueursInscrit(a),f=c>=0?a._event.draws[c]:a._previous;f&&(e=e.concat(this.drawLib.FindAllQualifieSortant(f,!0))),this.drawLib.resetDraw(a,e.length),this.RempliMatchs(a,d,e.length-a.nbOut)}else{if(d=this.CompteMatchs(a),b===models.GenerateType.PlusEchelonne){if(!this.TirageEchelonne(a,d))return}else if(b===models.GenerateType.PlusEnLigne&&!this.TirageEnLigne(a,d))return;e=this.GetJoueursTableau(a)}return this.tournamentLib.TriJoueurs(e),a=this.ConstruitMatch(a,d,e),[a]},a.prototype.RempliMatchs=function(a,b,c,d){var f=e(a.nbOut);d=d||f;for(var g=d;A>=g;g++)b[g]=0;for(var i=Math.max(d,f);c&&A>i;i++){var j=Math.min(c,h(i,a.nbOut));i>f&&(j=Math.min(j,2*b[i-1])),b[i]=j,c-=j}},a.prototype.CompteMatchs=function(a){var b,c,h,i,j=new Array(A),k=e(a.nbOut),l=k;j[l]=a.nbOut;var m=-j[l],n=d(a.nbColumn,a.nbOut);for(l++;n>=l;l++){h=0;var o=g(l),p=f(l);for(b=o;p>=b;b++){var q=this.findBox(a,b);q&&(this.isJoueurNouveau(q)||q.qualifIn)&&h++}if(j[l]=2*j[l-1]-h,m+=h-j[l],h||(c=l),!j[l])break}for(l++;n>=l;l++){h=0;var o=g(l),p=f(l);for(b=o;p>=b;b++){var q=this.findBox(a,b);q&&(this.isJoueurNouveau(q)||q.qualifIn)&&h++}if(m+=h,h){this.RempliMatchs(a,j,h,c);break}}for(l=k,m=-j[l];n>=l;l++){h=0;var o=g(l),p=f(l);for(b=o;p>=b;b++){var q=this.findBox(a,b);q&&(this.isJoueurNouveau(q)||q.qualifIn)&&h++}m+=h}for(l=k;n>=l;l++){if(j[l]>m){this.RempliMatchs(a,j,m,l);break}m-=j[l]}for(i=!1,m=0,l=k;n>l;l++)if(m+=j[l],j[l]){if(i){this.RempliMatchs(a,j,m,l+1);break}}else i=!0;return j},a.prototype.TirageEchelonne=function(a,b){for(var c=e(a.nbOut),f=d(a.nbColumn,a.nbOut),g=A-1;g>c;g--)if(void 0!==b[g]&&b[g]>1&&f>g+1){if(b[g+1]+1>2*(b[g]-1))continue;return b[g]--,g++,b[g]++,!0}return!1},a.prototype.TirageEnLigne=function(a,b){for(var c=e(a.nbOut),d=0,f=A-1;f>c;f--)if(void 0!==b[f]){var g=Math.min(d+b[f],h(f,a.nbOut));if(f>c&&(g=Math.min(g,2*b[f-1])),b[f]<g)return b[f]++,d--,this.RempliMatchs(a,b,d,f+1),!0;d+=b[f]}return!1},a.prototype.GetJoueursTableau=function(a){for(var b=[],c=0;c<a.boxes.length;c++){var d=a.boxes[c];d&&(d.qualifIn?b.push(d.qualifIn):this.isJoueurNouveau(d)&&b.push(d._player))}return b},a.prototype.ConstruitMatch=function(a,b,i){var m=this.drawLib.newDraw(a._event,a);m.boxes=[];for(var n=e(m.nbOut),o=d(m.nbColumn,m.nbOut),p=[],q=n;o>=q;q++)for(var t=g(q),u=f(q),x=t;u>=x;x++)D?p[w(x,m.nbOut)]=x:p[s(x,m.nbOut)]=x;var y=m.nbOut;1==y&&(y=h(o-n>>1));var z=j(m.nbColumn,m.nbOut),A=new Array(z+1),C=0,E=0,F=0;q=-1;for(var G=0;z>=G;G++){var H=p[G];if(-1!==H){c(H)!=q&&(q=c(H),E=b[q]||0,F=q>n?2*b[q-1]-E:0);var I=k(H);if(F>0){if(A[I]){C++,F--;var J=this.drawLib.newBox(m,m._event.matchFormat,H);m.boxes.push(J)}}else if(E>0&&(q===n||A[I])){A[H]=!0,E--;var K=this.drawLib.newBox(m,m._event.matchFormat,H);K.score="",m.boxes.push(K)}if(C>=i.length)break}}for(C=0;G>0;G--)if(H=p[G],-1!==H){if(!A[H]&&A[k(H)]){var L="number"==typeof i[C]?i[C]:0;if(L){var M=this.findBox(m,l(H));if(M&&M.qualifIn)for(var N=C+1;N>=y;N--)if(angular.isObject(i[N])){var O=i[N];i[N]=L,i[C]=O,L=0;break}}var P=this.findBox(m,H);P&&(delete P.score,L?this.drawLib.SetQualifieEntrant(P,L):(this.drawLib.MetJoueur(P,i[C]),m.minRank&&this.rank.isNC(m.minRank)&&m.maxRank&&this.rank.isNC(m.maxRank)||(N=D?v(H,m.nbOut):r(H,m.nbOut),y>=N&&!this.drawLib.FindTeteSerie(m,N)&&(P.seeded=N))),C++)}if(C>i.length)break}if(m.type!==models.DrawType.Final){var Q=this.drawLib.group(m);if(Q)for(x=1;B>=x&&this.drawLib.FindQualifieSortant(Q,x);x++);else x=1;t=g(n),u=f(n);for(var H=u;H>=t&&B>=x;H--,x++){var R=this.findBox(m,H);R&&this.drawLib.SetQualifieSortant(R,x)}}return m},a.prototype.boxesOpponents=function(a){var b=m(a.position),c=n(a.position);return{box1:this.find.by(a._draw.boxes,"position",b),box2:this.find.by(a._draw.boxes,"position",c)}},a.prototype.getSize=function(a){return a&&a.nbColumn&&a.nbOut?{width:a.nbColumn,height:h(d(a.nbColumn,a.nbOut),a.nbOut)}:{width:1,height:1}},a.prototype.computePositions=function(a){if(a&&a.nbColumn&&a.nbOut&&a.boxes&&a.boxes.length){for(var b=[],d=i(a.nbOut),g=j(a.nbColumn,a.nbOut),h=a.nbColumn-1+e(a.nbOut),k=g;k>=d;k--){var l=c(k),m=f(l),n=h-l,o=f(n-1)+2;b[k]={x:n,y:(m-k)*o+o/2-.5};var p=this.find.by(a.boxes,"position",k);p&&(p._x=b[k].x,p._y=b[k].y)}return b}},a.prototype.CalculeScore=function(a){return!0},a.prototype.isJoueurNouveau=function(a){if(!a)return!1;var b=a,c=this.boxesOpponents(a);return a.playerId&&(!!b.qualifIn||!(c.box1&&c.box1.playerId||c.box2&&c.box2.playerId))},a.prototype.SetQualifieEntrant=function(a,c,d){var e=a._draw;if(c){var f=this.drawLib.previousGroup(e);if(!d&&f&&f.length&&c!==C){var g=this.drawLib.FindQualifieSortant(f,c);angular.isObject(g)&&(d=g._player)}a.qualifIn&&(this.SetQualifieEntrant(a)||b(!1)),d&&(this.drawLib.MetJoueur(a,d)||b(!1)),c!==C&&this.drawLib.FindQualifieEntrant(e,c)||(a.qualifIn=c,this.iBoiteDeGauche(a.position,e,!0,function(a){a.hidden=!0}))}else a.qualifIn=0,this.drawLib.previousGroup(e)&&!this.drawLib.EnleveJoueur(a)&&b(!1),this.iBoiteDeGauche(a.position,e,!0,function(a){delete a.hidden});return!0},a.prototype.SetQualifieSortant=function(a,c){var d=this.drawLib.nextGroup(a._draw);if(c){if(d&&a.playerId&&a.qualifOut){var e=this.drawLib.FindQualifieEntrant(d,c);if(e&&(b(e.playerId===a.playerId),!this.drawLib.EnleveJoueur(e)))throw"Can not remove player"}a.qualifOut&&(this.SetQualifieSortant(a)||b(!1)),a.qualifOut=c,d&&a.playerId&&e&&!this.drawLib.MetJoueur(e,a._player,!0)}else{if(d&&a.playerId){var e=this.drawLib.FindQualifieEntrant(d,a.qualifOut);if(e&&(b(e.playerId&&e.playerId===a.playerId),!this.drawLib.EnleveJoueur(e,!0)))throw"Can not remove player"}delete a.qualifOut}return!0},a.prototype.FindQualifieEntrant=function(a,c){if(b(c>=0),a.boxes)for(var d=a.boxes.length-1;d>=0;d--){var e=a.boxes[d];if(e){var f=e.qualifIn;if(f===c||!c&&f)return e}}},a.prototype.FindQualifieSortant=function(a,c){return b(c>0),c!==C&&a.boxes?this.find.by(a.boxes,"qualifOut",c):void 0},a.prototype.iBoiteDeGauche=function(a,b,c,d){for(var e,f=!1,g=a;;){var h=g-a*q(p(g+1)-p(a+1));do{h++,e=h+a*q(p(h+1));var i=this.findBox(b,e);if(!i)return;f=i.playerId||c}while(!f);f&&d(i),g=e}},a}();a.Knockout=E,a.iPartieQ=t,angular.module("jat.services.knockout",["jat.services.drawLib","jat.services.tournamentLib","jat.services.type","jat.services.find"]).factory("knockout",["drawLib","tournamentLib","rank","find",function(a,b,c,d){return new E(a,b,c,d)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a,b){if(!a)throw b||"Assertion is false"}function c(a){return"score"in a}function d(a){var b=-1;for(a++;a;a>>=1,b++);return b}function e(a){return a&&1!==a?d(a-2)+1:0}function f(a,b){return b&&1!==b?d(b-2)+a:a-1}function g(a){return(1<<a+1)-2}function h(a,b){return b&&1!==b?g(a)-i(a,b)+1:(1<<a)-1}function i(a,b){return b&&1!==b?b*i(a-e(b),1):1<<a}function j(a,b){return b&&1!==b?g(f(a,b)):(1<<a)-2}function k(a){return(a<<1)+2}function l(a){return(a<<1)+1}function m(a,b){var c=(a||"").toUpperCase(),d=(b||"").toUpperCase();return c===d?0:d>c?-1:1}function n(a,b,c){var d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=new Date(b.getFullYear(),b.getMonth(),b.getDate());return Math.floor((e.getTime()-d.getTime())/c)}var o=32,p=32,q=-1,r=16,s=function(){function a(a,b,c,d,e,f,g,h){this.validation=a,this.knockout=b,this.drawLib=c,this.tournamentLib=d,this.rank=e,this.category=f,this.score=g,this.find=h,a.addValidator(this)}return a.prototype.validatePlayer=function(a){return!0},a.prototype.validateGroup=function(a){var b=!0;if(a.suite){var c=this.find.indexOf(a._event.draws,"id",a.id);0!==c&&a._previous||(this.validation.errorDraw("IDS_ERR_TAB_SUITE_PREMIER",a),b=!1);var d=this.drawLib.group(a);d&&(a.type!==d[0].type&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_TYPE",a),b=!1),a.minRank!=d[0].minRank&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_MIN",a),b=!1),a.maxRank!=d[0].maxRank&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_MAX",a),b=!1))}var e=this.drawLib.previousGroup(a);e&&e[0].type!==models.DrawType.Final&&a.minRank&&e[0].maxRank&&this.rank.compare(a.minRank,e[0].maxRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLASSMAX_OVR",a),b=!1);var f=this.drawLib.nextGroup(a);f&&a.type!==models.DrawType.Final&&a.maxRank&&f[0].minRank&&this.rank.compare(f[0].minRank,a.maxRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLASSMAX_NEXT_OVR",a),b=!1);var g=p;if(!a.suite){for(g=p;g>=1&&!this.drawLib.FindQualifieSortant(d,g);g--);for(var h=1;g>=h;h++)this.drawLib.FindQualifieSortant(d,h)||(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_NO",a,void 0,"Q"+h),b=!1)}return b},a.prototype.validateMatches=function(a){var b=!0;return b},a.prototype.validateDraw=function(a){var e=!0,i=0,l=0,s=a._event._tournament,u=a.type>=2;a.minRank&&a.maxRank&&this.rank.compare(a.maxRank,a.minRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLAST_INV",a),e=!1),a._event.maxRank&&this.rank.compare(a._event.maxRank,a.maxRank)<0&&(this.validation.errorDraw("IDS_ERR_TAB_CLASSLIM_OVR",a),e=!1),e=e&&this.validateGroup(a),e=e&&this.validateMatches(a);var v=f(a.nbColumn,a.nbOut),w=new Array(v+1);w[v]="NC";for(var x=0;x<a.boxes.length;x++){var y=a.boxes[x],z=c(y)?void 0:y,A=c(y)?y:void 0,B=y.position,C=d(B);B===g(C)&&v>C&&(w[C]=w[C+1]),z&&z.order<0&&!z.qualifIn&&!y.hidden&&(this.validation.errorDraw("IDS_ERR_TAB_DUPLI",a,z),e=!1);var D=y._player;if(D&&z&&this.knockout.isJoueurNouveau(z)&&!z.qualifIn&&(D.rank?(this.rank.within(D.rank,a.minRank,a.maxRank)||(this.validation.errorDraw("IDS_ERR_CLAST_MIS",a,z,D.rank),e=!1),w[C]<D.rank&&(w[C]=D.rank),v>C&&w[C+1]&&this.rank.compare(D.rank,w[C+1])<0&&(this.validation.errorDraw("IDS_ERR_CLAST_PROGR",a,z,D.rank),e=!1)):(this.validation.errorDraw("IDS_ERR_CLAST_NO",a,z),e=!1),this.tournamentLib.isSexeCompatible(a._event,D.sexe)?this.tournamentLib.isRegistred(a._event,D)||this.validation.errorDraw("IDS_ERR_INSCR_NO",a,z):this.validation.errorDraw("IDS_ERR_EPR_SEXE",a,z),this.category.isCompatible(a._event.category,D.category)||this.validation.errorDraw("IDS_ERR_CATEG_MIS",a,z)),A){b(k(B)<=j(a.nbColumn,a.nbOut));var E=this.knockout.boxesOpponents(A);if(b(!!E.box1&&!!E.box2),A.score?(b(B<h(a.nbColumn,a.nbOut)),A.playerId||(this.validation.errorDraw("IDS_ERR_SCORE_VAINQ_NO",a,A),e=!1),this.score.isValid(A.score)||(this.validation.errorDraw("IDS_ERR_SCORE_BAD",a,A,A.score),e=!1),b(d(B)<v),E.box1.playerId&&E.box2.playerId?E.box1.playerId!=A.playerId&&E.box2.playerId!=A.playerId&&(this.validation.errorDraw("IDS_ERR_VAINQUEUR_MIS",a,A),e=!1):(this.validation.errorDraw("IDS_ERR_MATCH_JOUEUR_NO",a,A),e=!1)):A.playerId&&(this.validation.errorDraw("IDS_ERR_VAINQ_SCORE_NO",a,A,A._player.name),e=!1),!this.isMatchJoue(A)){var F=this.drawLib.boxesOpponents(E.box1),G=this.drawLib.boxesOpponents(E.box2);E.box1.playerId?E.box2.playerId?m(E.box1._player.club,E.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB1",a,A,E.box1._player.club),e=!1):this.isMatchJouable(E.box2)&&(m(E.box1._player.club,G.box1._player.club)?m(E.box1._player.club,G.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,A,E.box1._player.club),e=!1):(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,A,E.box1._player.club),e=!1)):u||(E.box2.playerId?this.isMatchJouable(E.box1)&&(m(E.box2._player.club,F.box1._player.club)?m(E.box2._player.club,F.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,A,E.box2._player.club),e=!1):(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,A,E.box2._player.club),e=!1)):this.isMatchJouable(E.box1)&&this.isMatchJouable(E.box2)&&(m(F.box1._player.club,G.box1._player.club)&&m(F.box1._player.club,G.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,A,F.box1._player.club),e=!1),m(F.box2._player.club,G.box1._player.club)&&m(F.box2._player.club,G.box2._player.club)||(this.validation.errorDraw("IDS_ERR_MEME_CLUB2",a,A,F.box2._player.club),e=!1)))}if(A.date){if(a._event.start&&A.date<a._event.start&&(this.validation.errorDraw("IDS_ERR_DATE_MATCH_EPREUVE",a,A,A.date.toDateString()),e=!1),a._event.end&&a._event.end<A.date&&(this.validation.errorDraw("IDS_ERR_DATE_MATCH_EPREUVE",a,A,A.date.toDateString()),e=!1),s._dayCount=n(s.info.start,s.info.end,t.Day)+1,s._dayCount){var H=n(A.date,s.info.start,t.Day);if(H>=0&&H<s._dayCount){var I=s._day[H];b(I.length<=r);for(var J=I.length-1;J>=0;J--){var K=I[J];K.position!=A.position&&K.place==A.place&&Math.abs(A.date.getTime()-K.date.getTime())<s.info.slotLength&&(this.validation.errorDraw("IDS_ERR_PLN_OVERLAP",a,A,A.date.toDateString()),e=!1)}}else this.validation.errorDraw("IDS_ERR_DATE_MATCH_TOURNOI",a,A,A.date.toDateString()),e=!1}b(k(B)<=j(a.nbColumn,a.nbOut));var L=E.box1,K=E.box2;c(E.box1)&&L.date&&(A.date<L.date?(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,A,A.date.toDateString()),e=!1):A.date.getTime()<L.date.getTime()+(s.info.slotLength<<1)&&(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,A,A.date.toDateString()),e=!1)),c(E.box2)&&K.date&&(A.date<K.date?(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,A,A.date.toDateString()),e=!1):A.date.getTime()<K.date.getTime()+(s.info.slotLength<<1)&&(this.validation.errorDraw("IDS_ERR_DATE_MATCHS",a,A,A.date.toDateString()),e=!1)),A.date&&!A.playerId&&!A.place&&s.places.length&&s._dayCount&&(this.validation.errorDraw("IDS_ERR_PLN_COURT_NO",a,A),e=!1)}}if(z){var M=z.qualifIn;if(M&&M!=q){i++,b(!u||B>=h(a.nbColumn,a.nbOut));var N=this.find.indexOf(a._event.draws,"id",a.id);0==N&&(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_TAB1",a,z),e=!1);var O;a.suite||!(O=this.drawLib.FindQualifieEntrant(a,M))||O.position==B&&O._draw.id==a.id||(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_DUP",a,z),e=!1);var P=this.drawLib.previousGroup(a);P&&(O=this.drawLib.FindQualifieSortant(P,M),O?O.playerId!=z.playerId&&(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_PREC_MIS",a,z),e=!1):(this.validation.errorDraw("IDS_ERR_TAB_ENTRANT_PREC_NO",a,z),e=!1))}}if(A){var M=A.qualifOut;M&&(l++,O=this.drawLib.FindQualifieSortant(a,M),!O||O.position==B&&O._draw.id==a.id||(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_DUP",a,A),e=!1),a.type===models.DrawType.Final&&(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_FINAL",a,y),e=!1))}}if(!a.suite)for(var Q=0,M=1;o>=M;M++)if(z=this.drawLib.FindTeteSerie(a,M)){M>Q+1&&(this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_NO",z._draw,z,"Seeded "+M),e=!1),c(z)&&(this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_ENTRANT",z._draw,z,"Seeded "+M),e=!1);for(var x=0;x<a.boxes.length;x++){var R=a.boxes[x];R.seeded==M&&R.position!==z.position&&(this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_DUP",z._draw,z,"Seeded "+M),e=!1)}Q=M}if(!a.suite){var S=this.drawLib.previousGroup(a);if(S&&S.length)for(var M=1;p>=M;M++){var T=this.drawLib.FindQualifieSortant(S,M);z=this.drawLib.FindQualifieEntrant(a,M),T&&!z&&(this.validation.errorDraw("IDS_ERR_TAB_SORTANT_PREC_NO",a,void 0,"Q"+T.qualifOut),e=!1)}}return u&&l<a.nbOut&&(this.validation.errorDraw("IDS_ERR_POULE_SORTANT_NO",a),e=!1),a.type===models.DrawType.Final&&((a.suite||P[P.length-1].id!==a.id)&&(this.validation.errorDraw("IDS_ERR_TAB_SUITE_FINAL",a),e=!1),1!=a.nbOut&&(this.validation.errorDraw("IDS_ERR_TAB_FINAL_NQUAL",a),e=!1)),e},a.prototype.isMatchJoue=function(a){var b=this.drawLib.boxesOpponents(a);return!!a.playerId&&!!b.box1.playerId&&!!b.box2.playerId},a.prototype.isMatchJouable=function(a){if(!c(a))return!1;var b=this.drawLib.boxesOpponents(a);return!a.playerId&&!!b.box1.playerId&&!!b.box2.playerId},a}();a.KnockoutValidation=s;var t;!function(a){a[a.Day=864e5]="Day",a[a.Hour=36e5]="Hour"}(t||(t={})),angular.module("jat.services.validation.knockout",["jat.services.validation","jat.services.type"]).factory("knockoutValidation",["validation","knockout","drawLib","tournamentLib","rank","category","score","find",function(a,b,c,d,e,f,g,h){return new s(a,b,c,d,e,f,g,h)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a,b){if(!a)throw b||"Assertion is false"}function c(a,b){return Math.floor(a/b)}function d(a,b){return a%b}function e(a){return a*(a+1)}function f(a){return a*a+1}function g(a,b){return a%b+b*b}function h(a,b){return Math.floor(a/b)+b*b}function i(a,b,c){return b*c+a}function j(a,b,e){var f=d(a,b),g=c(a,b);return e-b+f+e*(e-b+g)}function k(a){var b=a._draw.nbColumn;return a.position%b*(b+1)}function l(a,b){return b%a*(a+1)}function m(a,b){var c=a.nbColumn;return b%c+c*c}var n=0,o=22,p=8191,q=63,r=-1,s=function(){function a(a,b,c,d){this.drawLib=a,this.tournamentLib=b,this.ranking=c,this.find=d,a._drawLibs[models.DrawType.PouleSimple]=a._drawLibs[models.DrawType.PouleAR]=this}return a.prototype.findBox=function(a,b,c){var d=this.find.by(a.boxes,"position",b);return!d&&c&&(d=this.drawLib.newBox(a,void 0,b)),d},a.prototype.nbColumnForPlayers=function(a,b){return b},a.prototype.boxesOpponents=function(a){var b=a._draw.nbColumn,c=g(a.position,b),d=h(a.position,b);return{box1:this.find.by(a._draw.boxes,"position",c),box2:this.find.by(a._draw.boxes,"position",d)}},a.prototype.getSize=function(a){if(!a.nbColumn)return{width:1,height:1};var b=a.nbColumn;return{width:b+1,height:b}},a.prototype.computePositions=function(a){},a.prototype.resize=function(a,b,c){if(c)throw"Not implemnted";if(b&&a.nbColumn!==b.nbColumn){for(var d=b.nbColumn,e=a.nbColumn,f=e*(e+1)-1,g=a.boxes.length-1;g>=0;g--){var h=a.boxes[g],i=j(h.position,d,e),k=l(e,i);0>i||i>f||i===k||k>i&&a.type===models.DrawType.PouleSimple?a.boxes.splice(g,1):h.position=i}if(e>d)for(var g=e-d-1;g>=0;g--){var i=m(a,g),n=this.drawLib.newBox(a,void 0,i);a.boxes.push(n);var k=l(e,i);for(i-=e;i>=0;i-=e)if(!(i===k||k>i&&a.type===models.DrawType.PouleSimple)){var o=this.drawLib.newBox(a,void 0,i);o.score="",a.boxes.push(o)}}}},a.prototype.FindQualifieEntrant=function(a,c){if(b(c>=0),a.boxes)for(var d=a.boxes.length-1;d>=0;d--){var e=a.boxes[d];if(e){var f=e.qualifIn;if(f===c||!c&&f)return e}}},a.prototype.FindQualifieSortant=function(a,c){if(b(c>0),c!==r&&a.boxes)for(var d=0;d<a.boxes.length;d++){var e=a.boxes[d];if(e&&e.qualifOut===c)return e}},a.prototype.SetQualifieEntrant=function(a,c,d){var e=a._draw;if(c){var f=this.drawLib.previousGroup(e);if(!d&&f&&c!=r){var g=this.drawLib.FindQualifieSortant(f,c);angular.isObject(g)&&(d=g._player)}a.qualifIn&&(this.SetQualifieEntrant(a)||b(!1)),d&&(this.drawLib.MetJoueur(a,d)||b(!1)),c!=r&&this.drawLib.FindQualifieEntrant(e,c)||this.SetQualifieEntrant(a,c)}else a.qualifIn=0,this.drawLib.previousGroup(e)&&!this.drawLib.EnleveJoueur(a)&&b(!1);return!0},a.prototype.SetQualifieSortant=function(a,c){var d=this.drawLib.nextGroup(a._draw),e=a._draw.boxes[k(a)],f=a._draw.boxes[m(a._draw,a.position)];if(c){if(d&&a.playerId&&a.qualifOut){var g=this.drawLib.FindQualifieEntrant(a._draw,c);g&&(b(g.playerId===a.playerId),this.drawLib.EnleveJoueur(g)||b(!1))}if(a.qualifOut&&(this.SetQualifieSortant(a)||b(!1)),this.SetQualifieSortant(a,c),e.playerId=f.playerId,this.drawLib.initBox(e,a._draw),d&&a.playerId){var g=this.drawLib.FindQualifieEntrant(d,c);g&&(b(!g.playerId),this.drawLib.MetJoueur(g,a._player,!0)||b(!1))}}else{var h=a;if(d&&a.playerId){var g=this.drawLib.FindQualifieEntrant(d,h.qualifOut);g&&(b(g.playerId&&g.playerId===a.playerId),this.drawLib.EnleveJoueur(g,!0)||b(!1))}delete h.qualifOut,e.playerId=void 0,this.drawLib.initBox(e,a._draw)}return!0},a.prototype.GetJoueursTableau=function(a){for(var b=[],c=this.drawLib.group(a),d=0;d<c.length;d++)for(var g=c[d],h=e(g.nbColumn),i=f(g.nbColumn),j=i;h>=j;j++){var k=this.findBox(g,j);k&&(k.qualifIn?b.push(k.qualifIn):k.playerId&&b.push(k._player))}return b},a.prototype.generateDraw=function(a,b,c){var d=this.drawLib.group(a),e=this.find.indexOf(a._event.draws,"id",d[0].id);-1===e&&(e=a._event.draws.length);var f=this.tournamentLib.GetJoueursInscrit(a),g=c>=0?o._event.draws[c]:void 0;g&&(f=f.concat(this.drawLib.FindAllQualifieSortant(g,!0))),this.tournamentLib.TriJoueurs(f);var h=a._event,i=Math.floor((f.length+(a.nbColumn-1))/a.nbColumn);if(i||(i=1),h.draws.length+i>=q)throw"Maximum refDraw count is reached";for(var j=[],k=a.name,n=0;i>n;n++){if(0===n)var o=a;else o=this.drawLib.newDraw(h,a),o.suite=!0;o.boxes=[],o.name=k+(i>1?" ("+(n+1)+")":"");for(var p=o.nbColumn-1;p>=0&&f.length;p--){var r=m(o,p),s=n+(o.nbColumn-p-1)*i,t=this.drawLib.newBox(o,void 0,r);if(o.boxes.push(t),s<f.length){var u="number"==typeof f[s]?f[s]:0;if(u){if(!this.drawLib.SetQualifieEntrant(t,u))return}else if(!this.drawLib.MetJoueur(t,f[s]))return}var v=l(o.nbColumn,r);for(r-=o.nbColumn;r>=0;r-=o.nbColumn)if(!(r===v||v>r&&o.type===models.DrawType.PouleSimple)){var w=this.drawLib.newBox(o,void 0,r);w.score="",o.boxes.push(w)}}var x=this.findBox(o,m(o,o.nbColumn-1));x.seeded=n+1,j.push(o)}return j},a.prototype.CalculeScore=function(a){throw"Not implemented";var b;return!0},a}();a.Roundrobin=s,angular.module("jat.services.roundrobin",["jat.services.drawLib","jat.services.tournamentLib","jat.services.type","jat.services.find"]).factory("roundrobin",["drawLib","tournamentLib","ranking","find",function(a,b,c,d){return new s(a,b,c,d)
}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return"score"in a}var c=function(){function a(a){this.validation=a,a.addValidator(this)}return a.prototype.validatePlayer=function(a){return!0},a.prototype.validateDraw=function(a){var b=!0;return b=b&&this.validatePoule(a),b=b&&this.validateMatches(a)},a.prototype.validatePoule=function(a){var b=!0;return b},a.prototype.validateMatches=function(a){for(var c=!0,d=0;d<a.boxes.length;d++){var e=a.boxes[d],f=b(e)?void 0:e,g=b(e)?e:void 0;e.playerId}return c},a}();a.RoundrobinValidation=c,angular.module("jat.services.validation.roundrobin",["jat.services.validation"]).factory("roundrobinValidation",["validation",function(a){return new c(a)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this._category={"-8ans":{ageMax:8},"-9ans":{ageMax:9},"-10ans":{ageMax:10},"-11ans":{ageMax:11},"-12ans":{ageMax:12},"-13ans":{ageMax:13},"-14ans":{ageMax:14},"-15ans":{ageMax:15},"-16ans":{ageMax:16},"-17ans":{ageMax:17},"-18ans":{ageMax:18},Senior:{ageMin:18,ageMax:34},"+35ans":{ageMin:35},"+45ans":{ageMin:45},"+55ans":{ageMin:55},"+65ans":{ageMin:60},"+70ans":{ageMin:70},"+75ans":{ageMin:75}},this._categories=[],this._index={};var a=new Date,b=new Date(a.getFullYear(),9,1);this.currentYear=a.getFullYear()+(a>b?1:0);for(var c in this._category)this._categories.push(c);for(var d=this._categories.length-1;d>=0;d--)this._index[this._categories[d]]=d}return a.prototype.list=function(){return this._categories},a.prototype.isValid=function(a){return this._index[a]>=0},a.prototype.compare=function(a,b){var c=this._index[a],d=this._index[b];return c-d},a.prototype.getAge=function(a){var b=this.currentYear-a.getFullYear();return b},a.prototype.ofDate=function(a){var b=this.getAge(a),c,d;for(c in this._category){var e=this._category[c];if(!(e.ageMax&&e.ageMax<b)){if(e.ageMin){if(e.ageMin<=b){d=c;continue}return d}return c}}},a.prototype.isCompatible=function(a,b){if(b||!a)return!0;var c=this._index.Senior,d=this._index[a];if(d===c)return!0;var e=this._category[a],f=this._category[b];if(c>d){if(f.ageMax<=e.ageMax)return!0}else if(e.ageMin<=f.ageMin)return!0;return!1},a}();a.Category=b,angular.module("jat.services.fft.category",[]).service("category",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){angular.module("jat.services.type",["jat.services.fft.score","jat.services.fft.category","jat.services.fft.licence","jat.services.fft.matchFormat","jat.services.fft.rank","jat.services.fft.ranking"])}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return"score"in a}function c(a){var b=-1;for(a++;a;a>>=1,b++);return b}function d(a,b){return b&&1!==b?c(b-2)+a:a-1}function e(a){return(1<<a+1)-2}function f(a,b){return b&&1!==b?e(d(a,b)):(1<<a)-2}var g=function(){function a(a,b,c,d){this.validation=a,this.drawLib=b,this.knockout=c,this.find=d,a.addValidator(this)}return a.prototype.validatePlayer=function(a){var b=!0;return b},a.prototype.validateDraw=function(a){for(var d=!0,e=a.type>=2,g={},h=0,i=0;i<a.boxes.length;i++){var j=a.boxes[i],k=b(j)?void 0:j,l=b(j)?j:void 0,m=j._player;if(m&&!e){var n=c(j.position),o=g[m.rank];o?Math.abs(o-n)>1&&(this.validation.errorDraw("IDS_ERR_CLAST_PROGR2",a,j,m.rank),d=!1):g[m.rank]=n}if(!e&&l){var p=this.knockout.boxesOpponents(l);p.box1.qualifIn&&p.box2.qualifIn&&(this.validation.errorDraw("IDS_ERR_ENTRANT_MATCH",a,p.box1),d=!1)}k&&k.qualifIn&&h++,e&&h>1&&(this.validation.errorDraw("IDS_ERR_POULE_ENTRANT_OVR",a,j),d=!1)}if(a.type===models.DrawType.Final){var q=this.drawLib.FindTeteSerie(a,1);if(!q){var r=this.find.by(a.boxes,"position",f(a.nbColumn,a.nbOut));this.validation.errorDraw("IDS_ERR_TAB_TETESERIE_FINAL_NO",a,r),d=!1}}return d},a}();a.FFTValidation=g,angular.module("jat.services.validation.fft",["jat.services.validation"]).factory("fftValidation",["validation","drawLib","knockout","find",function(a,b,c,d){return new g(a,b,c,d)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.isValid=function(b){var c=a.reLicence.exec(b+" ");if(null===c)return!1;var d=parseInt(c[1]),e=a.keys.charAt(d%23);return e==c[2]},a.reLicence=/^([0-9]{7})([A-HJ-NPR-Z])$/,a.keys="ABCDEFGHJKLMNPRSTUVWXYZ",a}();a.Licence=b,angular.module("jat.services.fft.licence",[]).service("licence",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this._matchFormats={A:{name:"A: traditionnel (3 sets à 6 jeux)"},B:{name:"B: traditionnel (3 sets à 6 jeux) - point décisif"},C:{name:"C: 3 sets à 4 jeux - jeu décisif à 4/4"},D:{name:"D: 3 sets à 4 jeux - jeu décisif à 4/4 - point décisif"},E:{name:"E: 3 sets à 3 jeux - jeu décisif à 2/2"},F:{name:"F: 3 sets à 3 jeux - jeu décisif à 2/2 - point décisif"},G:{name:"G: 3 jeux décisif"},H:{name:"H: 3 sets à 4 jeux - jeu décisif à 3/3 - point décisif"},I:{name:"I: 3 sets à 5 jeux - jeu décisif à 4/4 - point décisif"}}}return a.prototype.list=function(){return this._matchFormats},a}();a.MatchFormat=b,angular.module("jat.services.fft.matchFormat",[]).service("matchFormat",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this._group={"4e série":"NC,40,30/5,30/4,30/3,30/2,30/1","3e série":"30,15/5,15/4,15/3,15/2,15/1","2e série":"15,5/6,4/6,3/6,2/6,1/6","1e série":"0,-1/6,-2/6,-3/6,-4/6,-5/6",promotion:"-15,-30"},this._groups=[],this._groupOf={},this._ranks=[],this._index={};var a;for(a in this._group){this._groups.push(a);var b=this._group[a].split(",");this._ranks=this._ranks.concat(b);for(var c=b.length-1;c>=0;c--)this._groupOf[b[c]]=a}for(var c=this._ranks.length-1;c>=0;c--)this._index[this._ranks[c]]=c}return a.prototype.list=function(){return this._ranks},a.prototype.isValid=function(a){return this._index[a]>=0},a.prototype.isNC=function(a){return"NC"===a},a.prototype.next=function(a){var b=this._index[a];return this._ranks[b+1]},a.prototype.previous=function(a){var b=this._index[a];return this._ranks[b-1]},a.prototype.compare=function(a,b){var c=this._index[a],d=this._index[b];return c-d},a.prototype.within=function(a,b,c){return(!b||this.compare(b,a)<=0)&&(!c||this.compare(a,c)<=0)},a.prototype.groups=function(){return this._groups},a.prototype.groupOf=function(a){return this._groupOf[a]},a}();a.Rank=b,angular.module("jat.services.fft.rank",[]).service("rank",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function b(a){this._champs=["Points:","Différence de Sets:","Différence de Jeux:"],this.Points=0,this._serviceScore=a}return b.prototype.Empty=function(){this.Points=0},b.prototype.isVide=function(){return 0===this.Points},b.prototype.NomChamp=function(a){return this._champs[a]},b.prototype.ValeurChamp=function(a){switch(a){case 0:return this.dPoint.toString();case 1:return Math.floor(this.dSet2/2).toString();case 2:return this.dJeu.toString()}},b.prototype.AddResultat=function(b,c,d){var e=new a.ScoreFFT(c,d);return this.dPoint+=e.deltaPoint(b>0),this.dSet2+=e.deltaSet(b>0),this.dJeu+=e.deltaJeu(b>0),!0},b.prototype.Ordre=function(){return(this.dPoint+128<<24)+(this.dSet2+128<<16)+(this.dJeu+32768)},b}();a.Ranking=b,angular.module("jat.services.fft.ranking",[]).service("ranking",["score",b])}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.isValid=function(b){var c=a.reScore.exec(b+" ");if(null===c)return!1;for(var d=b.split(/\s+/),e=0,f=0,g=0;g<d.length;g++){var h=d[g].split("/"),i=parseInt(h[0]),j=parseInt(h[1]);if(i>j&&i>=6){if(i>=7&&5>j)return!1;e++}else if(j>i&&j>=6){if(j>=7&&5>i)return!1;f++}}return!0},a.reScore=/^(([0-9]{1,2}\/[0-9]{1,2})\s+){2,5}(Ab )?$/,a}();a.Score=b;var c=5,d=function(){function a(a,b){}return a.prototype.getnSet=function(){for(var a=0;c>a&&(this.m_Jeu[a].j1||this.m_Jeu[a].j2);)a++;return a-1},a.prototype.deltaSet=function(a){throw"Not implemented";for(var b=0,d=0;c>d&&(this.m_Jeu[d].j1||this.m_Jeu[d].j2);d++)b+=this.m_Jeu[d].j1>this.m_Jeu[d].j2?1:this.m_Jeu[d].j1<this.m_Jeu[d].j2?-1:0;var e;return e},a.prototype.deltaJeu=function(a){throw"Not implemented";for(var b=0,d=0;c>d&&(this.m_Jeu[d].j1||this.m_Jeu[d].j2);d++)b+=this.m_Jeu[d].j1-this.m_Jeu[d].j2;var e;return e},a.prototype.deltaPoint=function(a){throw"Not implemented";for(var b=0,d=0;c>d&&(this.m_Jeu[d].j1||this.m_Jeu[d].j2);d++)b+=this.m_Jeu[d].j1-this.m_Jeu[d].j2;var e,f;return b},a}();a.ScoreFFT=d,angular.module("jat.services.fft.score",[]).service("score",b)}(b=a.fft||(a.fft={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e,f,g,h,i,j,k){this.$log=a,this.$http=b,this.$q=c,this.$window=d,this.selection=e,this.tournamentLib=f,this.drawLib=g,this.validation=h,this.undo=i,this.find=j,this.guid=k}return a.prototype.newTournament=function(){var a={id:this.guid.create("T"),info:{name:""},players:[],events:[]};return this.selection.select(a,models.ModelType.Tournament),a},a.prototype.loadTournament=function(a){var b=this,c=this.$q.defer();if(a)if("string"==typeof a)this.$http.get(a).success(function(d,e){d._url=a,b.tournamentLib.initTournament(d),b.selection.select(d,models.ModelType.Tournament),c.resolve(d)}).error(function(a,b){c.reject(a)});else{var d=new FileReader;d.addEventListener("loadend",function(){try{var e=angular.fromJson(d.result);e._url=a,b.tournamentLib.initTournament(e),b.selection.select(e,models.ModelType.Tournament),c.resolve(e)}catch(f){c.reject(f.message)}}),d.addEventListener("onerror",function(){return c.reject(d.error.name)}),d.addEventListener("onabort",function(){return c.reject("aborted")}),d.readAsText(a)}else{var e=this.$window.localStorage.tournament;if(e){var f=angular.fromJson(e);this.tournamentLib.initTournament(f),this.selection.select(f,models.ModelType.Tournament),c.resolve(f)}else c.reject("nothing in storage")}return c.promise},a.prototype.saveTournament=function(a,b){var c={};return tool.copy(a,c),b?void this.$http.post(b||a._url,c).success(function(a,b){}).error(function(a,b){}):void(this.$window.localStorage.tournament=angular.toJson(c))},a.prototype.addPlayer=function(a,b){var c=a.players;b.id=this.guid.create("p"),this.undo.insert(c,-1,b,"Add "+b.name,models.ModelType.Player),this.selection.select(b,models.ModelType.Player)},a.prototype.editPlayer=function(a,b){var c=this.selection.player===b,d=a._tournament.players,e=this.find.indexOf(d,"id",a.id,"Player to update not found");this.undo.update(d,e,a,"Edit "+a.name+" "+e,models.ModelType.Player),c&&this.selection.select(a,models.ModelType.Player)},a.prototype.removePlayer=function(a){var b=a._tournament.players,c=this.find.indexOf(b,"id",a.id,"Player to remove not found");this.undo.remove(b,c,"Delete "+a.name+" "+c,models.ModelType.Player),this.selection.player===a&&this.selection.select(b[c]||b[c-1],models.ModelType.Player)},a.prototype.addEvent=function(a,b,c){var d=a.events,e=c?this.find.indexOf(d,"id",c.id)+1:d.length;b.id=this.guid.create("e"),this.undo.insert(d,e,b,"Add "+b.name,models.ModelType.Event),this.selection.select(b,models.ModelType.Event)},a.prototype.editEvent=function(a,b){var c=this.selection.event===b,d=a._tournament.events,e=this.find.indexOf(d,"id",a.id,"Event to edit not found");this.undo.update(d,e,a,"Edit "+a.name+" "+e,models.ModelType.Event),c&&this.selection.select(a,models.ModelType.Event)},a.prototype.removeEvent=function(a){var b=a._tournament.events,c=this.find.indexOf(b,"id",a.id,"Event to remove not found");this.undo.remove(b,c,"Delete "+b[c].name+" "+c,models.ModelType.Event),this.selection.event===a&&this.selection.select(b[c]||b[c-1],models.ModelType.Event)},a.prototype.addDraw=function(a,b,c){var d=a._event.draws,e=c?this.find.indexOf(d,"id",c.id):d.length-1;if(b){var f=this.drawLib.generateDraw(a,b,e);if(!f||!f.length)return;this.undo.splice(d,e+1,0,f,"Add "+a.name,models.ModelType.Draw);for(var g=0;g<f.length;g++)this.drawLib.initDraw(f[g],a._event);this.selection.select(f[0],models.ModelType.Draw)}else a.id=this.guid.create("d"),this.undo.insert(d,e+1,a,"Add "+a.name,models.ModelType.Draw),this.selection.select(a,models.ModelType.Draw)},a.prototype.updateDraw=function(a,b,c){var d=this.selection.draw===b,e=this.drawLib.group(b||a);if(c){var f=this.drawLib.generateDraw(a,c,-1);if(!f||!f.length)return}else this.drawLib.resize(a,b);var g=a._event.draws;if(c&&f&&e&&f.length){var h=this.find.indexOf(g,"id",e[0].id,"Draw to edit not found");this.undo.splice(g,h,e.length,f,"Generate "+models.GenerateType[c]+" "+a.name,models.ModelType.Draw);for(var h=0;h<f.length;h++)this.drawLib.initDraw(f[h],a._event);a=f[0]}else{var h=this.find.indexOf(g,"id",a.id,"Draw to edit not found");this.undo.update(g,h,a,"Edit "+a.name+" "+h,models.ModelType.Draw)}(d||c)&&(this.selection.select(a,models.ModelType.Draw),this.drawLib.refresh(a))},a.prototype.updateQualif=function(a){var b=this;this.undo.newGroup("Update qualified",function(){return b.drawLib.updateQualif(a),!0},a)},a.prototype.removeDraw=function(a){var b=a._event.draws,c=this.find.indexOf(b,"id",a.id,"Draw to remove not found");this.undo.remove(b,c,"Delete "+a.name+" "+c,models.ModelType.Draw),this.selection.draw===a&&this.selection.select(b[c]||b[c-1],models.ModelType.Draw)},a.prototype.validateDraw=function(a){this.validation.resetDraw(a),this.validation.validateDraw(a),this.selection.draw===a&&this.drawLib.refresh(a)},a.prototype.editMatch=function(a,b){var c=this;this.drawLib.initBox(a,a._draw);var d=b._draw.boxes,e=this.find.indexOf(d,"position",a.position,"Match to edit not found");this.undo.newGroup("Edit match",function(){if(c.undo.update(d,e,a,"Edit "+a.position+" "+e,models.ModelType.Match),a.qualifOut){var b=c.drawLib.nextGroup(a._draw);if(b){var f=c.drawLib.FindQualifieEntrant(b,a.qualifOut);f&&c.undo.update(f,"playerId",a.playerId,"Set player",function(){return c.drawLib.initBox(f,f._draw)})}}return!0})},a.prototype.erasePlanning=function(a){var b=this;this.undo.newGroup("Erase player",function(){return b.undo.update(a,"place",null),b.undo.update(a,"date",null),!0},a)},a}();a.MainLib=b,angular.module("jat.services.mainLib",["jat.services.selection","jat.services.find","jat.services.undo","jat.services.guid","jat.services.type","jat.services.tournamentLib","jat.services.drawLib","jat.services.knockout","jat.services.roundrobin","jat.services.validation","jat.services.validation.knockout","jat.services.validation.roundrobin","jat.services.validation.fft"]).factory("mainLib",["$log","$http","$q","$window","selection","tournamentLib","drawLib","knockout","roundrobin","validation","knockoutValidation","roundrobinValidation","fftValidation","undo","find","guid",function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return new b(a,c,d,e,f,g,h,k,o,p,q)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=6e4,c=1440*b,d=function(){function a(a,b,c){this.drawLib=a,this.rank=b,this.guid=c}return a.prototype.newTournament=function(a){var b={};return angular.isObject(a)&&angular.extend(b,a),this.initTournament(b),b},a.prototype.newInfo=function(a){var b={};return angular.isObject(a)&&angular.extend(b,a),b},a.prototype.initTournament=function(a){if(a.players)for(var d=a.players.length-1;d>=0;d--)this.initPlayer(a.players[d],a);if(a.events)for(var d=a.events.length-1;d>=0;d--)this.initEvent(a.events[d],a);a.info=a.info||{name:""},a.info.slotLength=a.info.slotLength||90*b,a.info.start&&a.info.end&&(a._dayCount=Math.floor((a.info.end.getTime()-a.info.start.getTime())/c+1))},a.prototype.newPlayer=function(a,b){var c={};return angular.isObject(b)&&angular.extend(c,b),c.id=c.id||this.guid.create("p"),delete c.$$hashKey,this.initPlayer(c,a),c},a.prototype.initPlayer=function(a,b){a._tournament=b},a.prototype.newEvent=function(a,b){var c={};return angular.isObject(b)&&angular.extend(c,b),c.id=c.id||this.guid.create("e"),delete c.$$hashKey,this.initEvent(c,a),c},a.prototype.initEvent=function(a,b){a._tournament=b;var c=a.draws=a.draws||[];if(c)for(var d=c.length-1;d>=0;d--){var e=c[d];this.drawLib.initDraw(e,a),e._previous=c[d-1],e._next=c[d+1]}},a.prototype.isRegistred=function(a,b){return b.registration&&-1!==b.registration.indexOf(a.id)},a.prototype.getRegistred=function(a){for(var b=[],c=a._tournament.players,d=0,e=c.length;e>d;d++){var f=c[d];this.isRegistred(a,f)&&b.push(f)}return b},a.prototype.TriJoueurs=function(a){var b=this,c=function(a,c){var d="number"==typeof a,e="number"==typeof c;return d&&e?0:d?-1:e?1:b.rank.compare(a.rank,c.rank)};a.sort(c);for(var d=0,e=1;d<a.length;e++)(e===a.length||c(a[d],a[e]))&&(tool.shuffle(a,d,e),d=e)},a.prototype.GetJoueursInscrit=function(a){for(var b=a._event._tournament.players,c=[],d=0,e=0;e<b.length;e++){var f=b[e];this.isRegistred(a._event,f)&&(!f.rank||this.rank.within(f.rank,a.minRank,a.maxRank))&&c.push(f)}return c},a.prototype.isSexeCompatible=function(a,b){return a.sexe===b||"M"===a.sexe&&!a.typeDouble},a}();a.TournamentLib=d,angular.module("jat.services.tournamentLib",["jat.services.drawLib","jat.services.type","jat.services.guid"]).factory("tournamentLib",["drawLib","rank","guid",function(a,b,c){return new d(a,b,c)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a._reindex=function(a,b){for(var c={_length:a.length},d=0;d<a.length;d++){var e=a[d],f=e[b];void 0!==f&&(c[f]=d)}a["_FindBy"+b]=c},a.prototype.indexOf=function(b,c,d,e){var f,g;if(null==d)return null;var h="_FindBy"+c;h in b||a._reindex(b,c);var i=b[h];if(d in i&&i._length===b.length?(f=i[d],g=b[f],g[c]!==d&&(a._reindex(b,c),g=b[h],f=g[d])):(a._reindex(b,c),g=b[h],f=g[d]),e&&void 0===f)throw e;return void 0!==f?f:-1},a.prototype.by=function(a,b,c,d){var e=this.indexOf(a,b,c,d);return a[e]},a.prototype.byId=function(a,b,c){var d=this.indexOf(a,"id",b,c);return a[d]},a}();a.Find=b,angular.module("jat.services.find",[]).service("find",b)}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.create=function(a){return(a||"")+Math.round(999*Math.random())},a}();a.Guid=b,angular.module("jat.services.guid",[]).service("guid",b)}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.select=function(a,b){if(a)b===models.ModelType.Box||"_player"in a&&a._draw?(this.tournament=a._draw._event._tournament,this.event=a._draw._event,this.draw=a._draw,this.box=a):b===models.ModelType.Draw||a._event?(this.tournament=a._event._tournament,this.event=a._event,this.draw=a,this.box=void 0):b===models.ModelType.Event||a.draws&&a._tournament?(this.tournament=a._tournament,this.event=a,this.draw=a.draws?a.draws[0]:void 0,this.box=void 0):b===models.ModelType.Player||a.name&&a._tournament?(this.tournament=a._tournament,this.player=a):(b===models.ModelType.Tournament||a.players&&a.events)&&(this.tournament=a,this.tournament.events[0]?(this.event=this.tournament.events[0],this.draw=this.event&&this.event.draws?this.event.draws[this.event.draws.length-1]:void 0):(this.event=void 0,this.draw=void 0),this.box=void 0,this.player&&this.player._tournament!==this.tournament&&(this.player=void 0));else if(b)switch(b){case models.ModelType.Tournament:this.tournament=void 0,this.player=void 0;case models.ModelType.Event:this.event=void 0;case models.ModelType.Draw:this.draw=void 0;case models.ModelType.Box:this.box=void 0;break;case models.ModelType.Player:this.player=void 0}},a}();a.Selection=b,angular.module("jat.services.selection",[]).service("selection",b)}(b=a.service||(a.service={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(){this.stack=[],this.head=-1,this.maxUndo=20}return a.prototype.reset=function(){this.stack=[],this.head=-1,this.group=null},a.prototype.action=function(b,c,d){if("function"!=typeof b)throw"Undo action: invalid fnAction";var e={type:a.ActionType.ACTION,fnAction:b,message:c||"",meta:d},f=b(!1);return this._pushAction(e),f},a.prototype.update=function(b,c,d,e,f){if("undefined"==typeof b)throw"Undo update: invalid obj";if("undefined"==typeof c)throw"Undo update: invalid member";if("undefined"==typeof d)throw"Undo update: invalid value";var g={type:a.ActionType.UPDATE,obj:b,member:c,value:b[c],message:e||"update",meta:f};if(b.splice&&("number"!=typeof c||0>c||b.length<=c))throw"Bad array position to update";b[c]=d,this._pushAction(g)},a.prototype.insert=function(b,c,d,e,f){if("undefined"==typeof b)throw"Undo insert: invalid obj";if("undefined"==typeof c)throw"Undo insert: invalid member";if("undefined"==typeof d)throw"Undo insert: invalid value";b.splice&&("number"!=typeof c||0>c||c>b.length)&&(c=b.length);var g={type:a.ActionType.INSERT,obj:b,member:c,value:void 0,message:e||(c===b.length?"append":"insert"),meta:f};b.splice?b.splice(c,0,d):b[c]=d,this._pushAction(g)},a.prototype.remove=function(b,c,d,e){if("undefined"==typeof b)throw"Undo remove: invalid obj";if("undefined"==typeof c)throw"Undo remove: invalid member";var f={type:a.ActionType.REMOVE,obj:b,member:c,value:b[c],message:d||"remove",meta:e};if(b.splice){if("number"!=typeof c||0>c||b.length<=c)throw"Bad array position to remove";b.splice(c,1)}else delete b[c];this._pushAction(f)},a.prototype.splice=function(b,c,d,e,f,g){if("undefined"==typeof b)throw"Undo splice: invalid obj";if("undefined"==typeof b.slice)throw"Undo splice: invalid obj not an array";if("number"!=typeof c)throw"Undo splice: invalid index";if(0>c||b.length<c)throw"Undo splice: bad array position to remove";var h={type:a.ActionType.SPLICE,obj:b,index:c,howmany:e.length,message:f||"splice",values:void 0,meta:g},i=e.slice(0,e.length);i.unshift(c,d),h.values=Array.prototype.splice.apply(b,i),this._pushAction(h)},a.prototype._pushAction=function(a){this.group?this.group.stack.push(a):(this.head++,this.stack.splice(this.head,this.stack.length,a),this._maxUndoOverflow())},a.prototype.newGroup=function(b,c,d){if(this.group)throw"Cannot imbricate group";this.group={type:a.ActionType.GROUP,stack:[],message:b||"",meta:d},"undefined"!=typeof c&&(c()?this.endGroup():this.cancelGroup())},a.prototype.endGroup=function(){if(!this.group)throw"No group defined";var a=this.group;this.group=null,a.stack.length&&this._pushAction(a)},a.prototype.cancelGroup=function(){if(!this.group)throw"No group defined";this._do(this.group,!0),this.group=null},a.prototype._do=function(b,c){if(this.meta=b.meta,b.type===a.ActionType.GROUP){var d;if(c)for(var e=b.stack.length-1;e>=0;e--)d=this._do(b.stack[e],!0);else for(e=0;e<b.stack.length;e++)d=this._do(b.stack[e],!1);return this.meta=b.meta,d}if(b.type===a.ActionType.ACTION)return b.fnAction(c);if(b.type===a.ActionType.UPDATE){var f=b.obj[b.member];return b.obj[b.member]=b.value,b.value=f,f}if(b.type===a.ActionType.SPLICE){var g=b.values.slice(0,b.values.length);return g.unshift(b.index,b.howmany),b.howmany=b.values.length,b.values=Array.prototype.splice.apply(b.obj,g),g[2]}return(c?b.type!==a.ActionType.INSERT:b.type!==a.ActionType.REMOVE)?b.obj.splice?(b.obj.splice(b.member,0,b.value),b.value):(b.obj[b.member]=b.value,b.value):(b.value=b.obj[b.member],void(b.obj.splice?b.obj.splice(b.member,1):delete b.obj[b.member]))},a.prototype.undo=function(){if(!this.canUndo())throw"Can't undo";var a=this._do(this.stack[this.head],!0);return this.head--,a},a.prototype.redo=function(){if(!this.canRedo())throw"Can't redo";return this.head++,this._do(this.stack[this.head],!1)},a.prototype.canUndo=function(){return 0<=this.head&&this.head<this.stack.length},a.prototype.canRedo=function(){return-1<=this.head&&this.head<this.stack.length-1},a.prototype.messageUndo=function(){return this.canUndo()?this.stack[this.head].message:""},a.prototype.messageRedo=function(){return this.canRedo()?this.stack[this.head+1].message:""},a.prototype.setMaxUndo=function(a){if("number"!=typeof a)throw"Invalid maxUndo value";this.maxUndo=a,this._maxUndoOverflow()},a.prototype._maxUndoOverflow=function(){if(this.stack.length>this.maxUndo){var a=this.stack.length-this.maxUndo;this.head-=a,this.stack.splice(0,a)}},a.prototype.getMeta=function(){return this.meta},a.prototype.toString=function(){return(this.group?"Grouping ("+this.group.message+"), ":"")+(this.canUndo()?this.head+1+" undo("+this.messageUndo()+")":"No undo")+", "+(this.canRedo()?this.stack.length-this.head+" redo("+this.messageRedo()+")":"No redo")+", maxUndo="+this.maxUndo},a.ActionType={UPDATE:1,INSERT:2,REMOVE:3,GROUP:4,ACTION:5,SPLICE:6},a}();a.Undo=b,angular.module("jat.services.undo",[]).service("undo",b)}(b=a.service||(a.service={}))}(jat||(jat={})),angular.module("jat.services",[]).value("version","0.1");var jat;!function(a){var b;!function(a){var b=function(){function a(a){this.find=a,this._validLibs=[],this._errorsDraw={},this._errorsPlayer={}}return a.prototype.addValidator=function(a){this._validLibs.push(a)},a.prototype.validatePlayer=function(a){for(var b=!0,c=0;c<this._validLibs.length;c++)b=b&&this._validLibs[c].validatePlayer(a);return b},a.prototype.validateDraw=function(a){for(var b=!0,c=0;c<this._validLibs.length;c++)b=b&&this._validLibs[c].validateDraw(a);return b},a.prototype.errorPlayer=function(a,b,c){var d=[];d.push("Validation error on",b.name),c&&d.push("("+c+")"),d.push(":",a),console.warn(d.join(" "));var e=this._errorsPlayer[b.id];e||(e=this._errorsPlayer[b.id]=[]),e.push({message:a,player:b,detail:c})},a.prototype.errorDraw=function(a,b,c,d){var e=[];e.push("Validation error on",b.name),c&&c._player&&e.push("for",c._player.name),d&&e.push("("+d+")"),e.push(":",a),console.warn(e.join(" "));var f=this._errorsDraw[b.id];f||(f=this._errorsDraw[b.id]=[]),f.push({message:a,player:c?c._player:void 0,position:c?c.position:void 0,detail:d})},a.prototype.hasErrorDraw=function(a){var b=a&&this._errorsDraw[a.id];return b&&b.length>0},a.prototype.hasErrorBox=function(a){var b=a&&this._errorsDraw[a._draw.id];if(b)var c=this.find.by(b,"position",a.position);return!!c},a.prototype.getErrorDraw=function(a){return a&&this._errorsDraw[a.id]},a.prototype.getErrorBox=function(a){var b=a&&this._errorsDraw[a._draw.id];return b?this.find.by(b,"position",a.position):void 0},a.prototype.resetPlayer=function(a){a?delete this._errorsPlayer[a.id]:this._errorsPlayer={}},a.prototype.resetDraw=function(a){a?delete this._errorsDraw[a.id]:this._errorsDraw={}},a}();a.Validation=b,angular.module("jat.services.validation",["jat.services.find"]).factory("validation",["find",function(a){return new b(a)}])}(b=a.service||(a.service={}))}(jat||(jat={}));var polyfill;!function(a){"console"in window||(window.console={info:angular.noop,log:angular.noop,warn:angular.noop,error:angular.noop}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(1/0===Math.abs(f)&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){var g;if(c in d&&d[c]===a)return c;c++}return-1})}(polyfill||(polyfill={}));var tool;!function(a){function b(a,c){if(c){if(a===c)throw Error("Can't copy equivalent objects or arrays");if(angular.isArray(a)){c.length=0;for(var d=0;d<a.length;d++)c.push(b(a[d]))}else for(var e in a)a.hasOwnProperty(e)&&-1=="_$".indexOf(e.charAt(0))&&(c[e]=b(a[e]))}else c=a,a&&(angular.isArray(a)?c=b(a,[]):angular.isDate(a)?c=new Date(a.getTime()):angular.isObject(a)&&(c=b(a,{})));return c}function c(a,b,c){b=b||0,arguments.length<3&&(c=a.length);var d=c-b;if(2==d){var e=a[0];a[0]=a[1],a[1]=e}else for(var f=c-1;f>b;f--){var g=b+Math.floor(d*Math.random()),e=a[g];a[g]=a[f],a[f]=e}return a}function d(a,b){for(var c=new Array(a),d=a-1;d>=0;d--)c[d]=0;return c}function e(a){if(a){for(var b={},c=a.length-1;c>=0;c--){var d=a[c];d.id&&(b[d.id]=d)}return b}}a.copy=b,a.shuffle=c,a.filledArray=d,a.hashById=e}(tool||(tool={})),angular.module("jat.utils.checkList",[]).directive("checkList",function(){return{scope:{list:"=checkList",value:"@"},link:function(a,b,c){function d(){var c=b.prop("checked");a.list||(a.list=[]);var d=a.list.indexOf(a.value);c&&-1==d?a.list.push(a.value):c||-1==d||a.list.splice(d,1)}a.$watch("list",function(c){if(c){var d=c.indexOf(a.value);b.prop("checked",-1!=d)}},!0),b.bind("change",function(){a.$apply(d)})}}});var ec;!function(a){var b;!function(a){function b(){return{restrict:"EA",templateUrl:"template/inputFile.html",transclude:!0,scope:{onloaded:"&"},link:function a(b,c,d){c.css({position:"relative"}),c.find("input").on("change",function(a){b.onloaded({file:a.target.files[0]})})}}}function c(a){a.put("template/inputFile.html","<input type='file' accept='application/json,text/plain' style='position: relative; text-align: right; -webkit-opacity:0; -moz-opacity:0; filter: alpha(opacity: 0); opacity: 0; z-index: 2; width: 80px;'><button style='position:absolute; left:0px; width:100%; z-index:1;' class='btn' ng-transclude></button>")}angular.module("ec.inputFile",[]).directive("ecInputFile",b).run(["$templateCache",c])}(b=a.ui||(a.ui={}))}(ec||(ec={}));var ec;!function(a){var b;!function(a){function b(){return{restrict:"EA",transclude:!0,replace:!0,scope:{},controller:"PanelsetController",templateUrl:"template/panels/panelset.html"}}function c(){return{require:"^ecPanelset",restrict:"EA",replace:!0,templateUrl:"template/panels/panel.html",transclude:!0,scope:{isOpen:"=?",isDisabled:"=?"},controller:"PanelController",link:function a(b,c,d,e){e.addPanel(b),b.$watch("isOpen",function(a){return e.select(b,!!a)}),b.toggleOpen=function(){b.isDisabled||(b.isOpen=!b.isOpen)},b.getWidth=function(){return e.selectCount?Math.floor(100/e.selectCount)+"%":"auto"}}}}function d(){return{require:"^ecPanelset",restrict:"EA",replace:!0,templateUrl:"template/panels/badge.html",transclude:!0,scope:{},link:function a(b,c,d,e){b.panel=null,e.addBadge(b)}}}function e(){return{require:"^ecPanel",restrict:"EA",replace:!0,templateUrl:"template/panels/header.html",transclude:!0,link:function a(b,c,d,e){b.panel=e.scope}}}function f(a){a.put("template/panels/panelset.html","<div class='panels' ng-transclude></div>"),a.put("template/panels/badge.html","<div class='panelbadge' ng-class='{active: panel.isOpen, disabled: panel.isDisabled}' ng-style=\"{'margin-left': (panel.marginLeft) * 3 +'em'}\" ng-click='panel.toggleOpen()' ng-dblclick='panel.toggleOpen(true)' ng-transclude></div>"),a.put("template/panels/panel.html","<div class='panel' ng-class='{active: isOpen, disabled: isDisabled}' ng-style=\"{'width': isOpen ? getWidth() : 0}\" ng-transclude></div>"),a.put("template/panels/header.html","<div class='header' ng-style=\"{'margin-left': (1 + panel.marginLeft) * 3 +'em'}\" ng-transclude></div>")}var g=function(){function a(){this.panels=[],this.badges=[],this.selectCount=0}return a.prototype.select=function(a,b){this.selectCount=0;for(var c=0;c<this.panels.length;c++)if(this.panels[c].marginLeft=c,this.panels[c].isOpen){this.selectCount++;break}var d=c,e=0;for(c=this.panels.length-1;c>d;c--)this.panels[c].isOpen?(this.selectCount++,e=0):e--,this.panels[c].marginLeft=e},a.prototype.addBadge=function(a){var b=this;this.badges.push(a),a.$on("$destroy",function(){return b.removeBadge(a)})},a.prototype.addPanel=function(a){var b=this,c=this.badges[this.panels.length];c.panel=a,a.badge=c,a.marginLeft=0,this.panels.push(a),a.isOpen&&this.selectCount++,a.$on("$destroy",function(){return b.removePanel(a)})},a.prototype.removePanel=function(a){var b=this.panels.indexOf(a);a.isOpen&&this.selectCount--,a.badge&&delete a.badge.panel,this.panels.splice(b,1)},a.prototype.removeBadge=function(a){var b=this.badges.indexOf(a);a.panel&&delete a.panel.badge,this.badges.splice(b,1)},a}(),h=function(){function a(a){this.scope=a}return a.$inject=["$scope"],a}();angular.module("ec.panels",[]).controller("PanelsetController",g).controller("PanelController",h).directive("ecPanelset",b).directive("ecPanel",c).directive("ecBadge",d).directive("ecHeader",e).run(["$templateCache",f])
}(b=a.ui||(a.ui={}))}(ec||(ec={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e,f,g){var h=this;this.title=a,this.draw=b,this.rank=c,this.drawLib=e,this.tournamentLib=f,this.drawTypes=[];for(var i=0;4>i;i++)this.drawTypes[i]={value:i,label:models.DrawType[i]};this.ranks=c.list(),this.categories=d.list(),g.$watch("dlg.draw.minRank",function(a){(!h.draw.maxRank||h.rank.compare(a,h.draw.maxRank)>0)&&(h.draw.maxRank=a)}),g.$watch("dlg.draw.maxRank",function(a){a&&h.draw.minRank&&h.rank.compare(h.draw.minRank,a)>0&&(h.draw.minRank=a)})}return a.prototype.getRegisteredCount=function(){var a=this.tournamentLib.GetJoueursInscrit(this.draw).length,b=this.drawLib.previousGroup(this.draw);if(b){var c=this.drawLib.FindAllQualifieSortant(b);c&&(a+=c.length)}return a},a.$inject=["title","draw","rank","category","drawLib","tournamentLib","$scope"],a}();angular.module("jat.draw.dialog",[]).controller("dialogDrawCtrl",b)}(b=a.draw||(a.draw={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e){this.title=a,this.match=b;var f=b._draw._event._tournament,g=d.boxesOpponents(b);this.player1=c.byId(f.players,g.box1.playerId),this.player2=c.byId(f.players,g.box2.playerId),this.places=f.places,this.matchFormats=e.list()}return a.$inject=["title","match","find","drawLib","matchFormat"],a}();angular.module("jat.match.dialog",["jat.services.drawLib","jat.services.find","jat.services.type"]).controller("dialogMatchCtrl",b)}(b=a.match||(a.match={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return{restrict:"EA",scope:!0,templateUrl:"views/draw/drawBox.html",controller:d,controllerAs:"ctrlBox",link:function(b,d,e,f){b.$watch(e.drawBox,function(b){f.box=b,f.isMatch=c(b),f.error=a.getErrorBox(b)})}}}function c(a){return a&&"score"in a}var d=function(){function a(){}return a.prototype.isPlayed=function(){return this.isMatch&&!!this.box.score},a}();angular.module("jat.draw.box",["jat.services.find"]).directive("drawBox",["validation",b])}(b=a.draw||(a.draw={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(a){return{pos1:(a<<1)+2,pos2:(a<<1)+1}}function c(){return{restrict:"EA",scope:!0,templateUrl:"views/draw/drawDraw.html",controller:f,controllerAs:"ctrlDraw",link:function(a,b,c,d){var e=function(e,f){d.draw=e,d.isKnockout=e&&e.type<2,d.boxWidth=a.$eval(c.boxWidth)||150,d.boxHeight=a.$eval(c.boxHeight)||40,d.interBoxWidth=a.$eval(c.interBoxWidth)||10,d.interBoxHeight=a.$eval(c.interBoxHeight)||10,d.simple=a.$eval(c.simple),d.init(),d.computeCoordinates(),d.isKnockout&&g&&d.drawLines(b)};a.$watch(c.draw,e),a.$watch(c.draw+"._refresh",function(a,b){a!==b&&e(d.draw)})}}}function d(){g&&(h=function(a,b,c){this._width=b,this._height=c,this.beginPath(),this._element=a,this._element.find("shape").remove()},h.prototype={_path:[],_tx:0,_ty:0,translate:function(a,b){},beginPath:function(){this._path.length=0,this.lineWidth=1,this.strokeStyle="black"},moveTo:function(a,b){this._path.push("m",this._tx+a,",",this._ty+b)},lineTo:function(a,b){this._path.push("l",this._tx+a,",",this._ty+b)},stroke:function(){},done:function(){var a=angular.element('<v:shape coordsize="'+this._width+" "+this._height+'" style="position:absolute; left:0px; top:0px; width:'+this._width+"px; height:"+this._height+'px;" filled="0" stroked="1" strokecolor="'+this.strokeStyle+'" strokeweight="'+this.lineWidth+'px" path="'+this._path.join("")+'" />');this._element.append(a)}})}function e(){return{restrict:"A",require:"^draw",link:function(a,b,c,d){a.$watch(c.drawLines,function(){d.drawLines(b)})}}}var f=function(){function a(a,b,c,d,e){this.drawLib=a,this.tournamentLib=b,this.find=c,this.undo=d,this.selection=e,this.boxWidth=150,this.boxHeight=40,this.interBoxWidth=10,this.interBoxHeight=10,this.simple=!1}return a.prototype.init=function(){if(this.draw&&!this.simple){this.players=this.tournamentLib.GetJoueursInscrit(this.draw);var a=this.drawLib.previousGroup(this.draw);this.qualifsIn=a?this.drawLib.FindAllQualifieSortantBox(a):void 0,this.qualifsOut=[];for(var b=1;b<=this.draw.nbOut;b++)this.qualifsOut.push(b)}},a.prototype.computeCoordinates=function(){if(this.draw){var a=this.draw,b=this.drawLib.getSize(a);if(this.width=b.width*this.boxWidth-this.interBoxWidth,this.height=b.height*this.boxHeight,a._points=this.drawLib.computePositions(a),this._refresh=new Date,!this.isKnockout){var c=a.nbColumn;this.rows=new Array(c);for(var d=0;c>d;d++){for(var e=new Array(c+1),f=(c+1)*c-d-1,g=0;c>=g;g++)e[g]=f,f-=c;this.rows[d]=e}}}},a.prototype.drawLines=function(a){a.attr("width",this.width).attr("height",this.height);var c=this.draw;if(c&&c.boxes&&c.boxes.length&&!(2<=c.type)){var d=a[0],e=g?new h(a,this.width,this.height):d.getContext("2d");e.lineWidth=.5,e.translate(.5,.5);for(var f=this.boxHeight>>1,i=c.boxes.length-1;i>=0;i--){var j=c.boxes[i],k=j._x*this.boxWidth,l=j._y*this.boxHeight;if(this.isMatch(j)){var m=b(j.position),n=c._points[m.pos1],o=c._points[m.pos2];n&&o&&(e.moveTo(k-this.interBoxWidth,n.y*this.boxHeight+f),e.lineTo(k,l+f),e.lineTo(k-this.interBoxWidth,o.y*this.boxHeight+f),e.stroke())}e.moveTo(k,l+f),e.lineTo(k+this.boxWidth-this.interBoxWidth,l+f),e.stroke()}e.done&&e.done()}},a.prototype.getBox=function(a){return this.draw&&this.draw.boxes?this.find.by(this.draw.boxes,"position",a):void 0},a.prototype.isDiag=function(a){if(this.draw){var b=this.draw.nbColumn;return a%b*(b+1)===a}},a.prototype.range=function(a,b,c){c=c||1;for(var d=[],e=a;b>=e;e+=c)d.push(e);return d},a.prototype.getQualifsIn=function(){return this.qualifsIn},a.prototype.getQualifsOut=function(){return this.qualifsOut},a.prototype.getPlayers=function(){return this.players},a.prototype.findQualifIn=function(a){return this.draw&&!!this.find.by(this.draw.boxes,"qualifIn",a)},a.prototype.findPlayer=function(a){return this.draw&&a&&!!this.find.by(this.draw.boxes,"playerId",a)},a.prototype.setPlayer=function(a,b,c){var d=this,e=a._player,f=a.qualifIn;this.undo.action(function(g){f||c?d.drawLib.SetQualifieEntrant(a,g?f:c,g?e:b):(a.playerId=g?e?e.id:void 0:b?b.id:void 0,d.drawLib.initBox(a,a._draw)),d.selection.select(a,models.ModelType.Box)},b?"Set player":"Erase player")},a.prototype.swapPlayer=function(a){},a.prototype.eraseScore=function(a){var b=this;this.undo.newGroup("Erase score",function(){return b.undo.update(a,"score",""),!0},a)},a.prototype.isMatch=function(a){return a&&"score"in a},a.$inject=["drawLib","tournamentLib","find","undo","selection"],a}(),g=!window.HTMLCanvasElement,h;angular.module("jat.draw.list",["jat.services.drawLib","jat.services.knockout","jat.services.roundrobin","jat.services.tournamentLib","jat.services.find","jat.services.undo","jat.services.selection"]).directive("draw",c).directive("drawLines",e).run(d)}(b=a.draw||(a.draw={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e,f){this.selection=a,this.title=b,this.event=c,this.tournamentLib=d,this.ranks=e.list(),this.categories=f.list(),this.registred=d.getRegistred(c)}return a.$inject=["selection","title","event","tournamentLib","rank","category"],a}();angular.module("jat.event.dialog",[]).controller("dialogEventCtrl",b)}(b=a.event||(a.event={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(){var a={templateUrl:"views/event/listEvents.html",controller:"listEventsCtrl",controllerAs:"list",restrict:"EA",scope:!0,link:function(a,b,c,d){a.$watch(c.listEvents,function(a,b,c){d.events=a})}};return a}var c=function(){function a(){}return a}();angular.module("jat.event.list",[]).directive("listEvents",b).controller("listEventsCtrl",c)}(b=a.event||(a.event={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(){var a={templateUrl:"views/main.html",controller:"mainCtrl",controllerAs:"main",restrict:"EA"};return a}var c=function(){function a(a,b,c,d,e,f,g,h,i){var j=this;this.$modal=a,this.selection=b,this.mainLib=c,this.tournamentLib=d,this.drawLib=e,this.validation=f,this.undo=g,this.$window=h,this.$timeout=i,this.GenerateType=models.GenerateType,this.ModelType=models.ModelType,this.Mode=models.Mode,this.selection.tournament=this.tournamentLib.newTournament();var k="/data/tournament8.json";this.mainLib.loadTournament(k).then(function(a){});var l=function(a){j.mainLib.saveTournament(j.selection.tournament)};h.addEventListener?h.addEventListener("beforeunload",l):h.onbeforeunload=l}return a.prototype.newTournament=function(){this.mainLib.newTournament(),this.editTournament(this.selection.tournament)},a.prototype.loadTournament=function(a){this.mainLib.loadTournament(a)},a.prototype.saveTournament=function(){this.mainLib.saveTournament(this.selection.tournament,"")},a.prototype.editTournament=function(a){var b=this,c=this.tournamentLib.newInfo(this.selection.tournament.info);this.$modal.open({templateUrl:"views/tournament/dialogInfo.html",controller:"dialogInfoCtrl as dlg",resolve:{title:function(){return"Edit info"},info:function(){return c}}}).result.then(function(a){if("Ok"===a){var d=b.selection.tournament;b.undo.update(b.selection.tournament,"info",c,"Edit info")}})},a.prototype.select=function(a,b){var c=this;return a&&b?(this.selection.select(void 0,b),void this.$timeout(function(){return c.selection.select(a,b)},0)):void this.selection.select(a,b)},a.prototype.addPlayer=function(){var a=this,b=this.tournamentLib.newPlayer(this.selection.tournament);this.$modal.open({templateUrl:"views/player/dialogPlayer.html",controller:"dialogPlayerCtrl as dlg",resolve:{title:function(){return"New player"},player:function(){return b},events:function(){return a.selection.tournament.events}}}).result.then(function(c){"Ok"===c&&a.mainLib.addPlayer(a.selection.tournament,b)})},a.prototype.editPlayer=function(a){var b=this,c=this.tournamentLib.newPlayer(this.selection.tournament,a);this.$modal.open({templateUrl:"views/player/dialogPlayer.html",controller:"dialogPlayerCtrl as dlg",resolve:{title:function(){return"Edit player"},player:function(){return c},events:function(){return b.selection.tournament.events}}}).result.then(function(d){"Ok"===d?b.mainLib.editPlayer(c,a):"Del"===d&&b.mainLib.removePlayer(a)})},a.prototype.removePlayer=function(a){this.mainLib.removePlayer(a)},a.prototype.addEvent=function(a){var b=this,c=this.tournamentLib.newEvent(this.selection.tournament);this.$modal.open({templateUrl:"views/event/dialogEvent.html",controller:"dialogEventCtrl as dlg",resolve:{title:function(){return"New event"},event:function(){return c}}}).result.then(function(d){"Ok"===d&&b.mainLib.addEvent(b.selection.tournament,c,a)})},a.prototype.editEvent=function(a){var b=this,c=this.tournamentLib.newEvent(this.selection.tournament,a);this.$modal.open({templateUrl:"views/event/dialogEvent.html",controller:"dialogEventCtrl as dlg",resolve:{title:function(){return"Edit event"},event:function(){return c}}}).result.then(function(d){"Ok"===d?b.mainLib.editEvent(c,a):"Del"===d&&b.mainLib.removeEvent(a)})},a.prototype.removeEvent=function(a){this.mainLib.removeEvent(a)},a.prototype.addDraw=function(a){var b=this,c=this.drawLib.newDraw(this.selection.event,void 0,a);this.$modal.open({templateUrl:"views/draw/dialogDraw.html",controller:"dialogDrawCtrl as dlg",resolve:{title:function(){return"New draw"},draw:function(){return c}}}).result.then(function(d){"Ok"===d?b.mainLib.addDraw(c,0,a):"Generate"===d&&b.mainLib.addDraw(c,1,a)})},a.prototype.editDraw=function(a){var b=this,c=this.drawLib.newDraw(a._event,a);this.$modal.open({templateUrl:"views/draw/dialogDraw.html",controller:"dialogDrawCtrl as dlg",resolve:{title:function(){return"Edit draw"},draw:function(){return c}}}).result.then(function(d){"Ok"===d?b.mainLib.updateDraw(c,a):"Generate"===d?b.mainLib.updateDraw(c,a,1):"Del"===d&&b.mainLib.removeDraw(a)})},a.prototype.validateDraw=function(a){this.mainLib.validateDraw(a)},a.prototype.generateDraw=function(a,b){this.mainLib.updateDraw(a,void 0,b||models.GenerateType.Create)},a.prototype.updateQualif=function(a){this.mainLib.updateQualif(a)},a.prototype.removeDraw=function(a){this.mainLib.removeDraw(a)},a.prototype.isMatch=function(a){return a&&"score"in a},a.prototype.editMatch=function(a){var b=this,c=this.drawLib.newBox(a._draw,a);this.$modal.open({templateUrl:"views/draw/dialogMatch.html",controller:"dialogMatchCtrl as dlg",resolve:{title:function(){return"Edit match"},match:function(){return c}}}).result.then(function(d){"Ok"===d&&b.mainLib.editMatch(c,a)})},a.prototype.doUndo=function(){this.selection.select(this.undo.undo(),this.undo.getMeta())},a.prototype.doRedo=function(){this.selection.select(this.undo.redo(),this.undo.getMeta())},a.$inject=["$modal","selection","mainLib","tournamentLib","drawLib","validation","undo","$window","$timeout"],a}();a.mainCtrl=c,angular.module("jat.main",["jat.services.mainLib","jat.services.selection","jat.services.undo","jat.services.tournamentLib","jat.services.drawLib","jat.services.knockout","jat.services.roundrobin","jat.services.validation","jat.services.validation.knockout","jat.services.validation.roundrobin","jat.services.validation.fft","jat.tournament.dialog","jat.player.dialog","jat.player.list","jat.event.dialog","jat.event.list","jat.draw.dialog","jat.draw.list","jat.draw.box","jat.match.dialog","ec.panels","ec.inputFile","ui.bootstrap"]).directive("main",b).controller("mainCtrl",c)}(b=a.main||(a.main={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e){this.title=a,this.player=b,this.events=c,this.ranks=d.list(),this.categories=e.list()}return a.$inject=["title","player","events","rank","category"],a}();a.dialogPlayerCtrl=b,angular.module("jat.player.dialog",["jat.utils.checkList"]).controller("dialogPlayerCtrl",b)}(b=a.player||(a.player={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){function b(){var a={templateUrl:"views/player/listPlayers.html",controller:"listPlayersCtrl",controllerAs:"list",restrict:"EA",scope:!0,link:function(a,b,c,d){a.$watch(c.listPlayers,function(a,b,c){d.players=a})}};return a}var c=function(){function a(a,b){this.selection=a,this.find=b}return a.prototype.eventById=function(a){return this.selection.tournament&&this.selection.tournament.events?this.find.byId(this.selection.tournament.events,a):void 0},a.$inject=["selection","find"],a}();angular.module("jat.player.list",["jat.services.selection","jat.services.find"]).directive("listPlayers",b).controller("listPlayersCtrl",c)}(b=a.player||(a.player={}))}(jat||(jat={}));var jat;!function(a){var b;!function(a){var b=function(){function a(a,b){this.title=a,this.info=b}return a.$inject=["title","info"],a}();angular.module("jat.tournament.dialog",[]).controller("dialogInfoCtrl",b)}(b=a.tournament||(a.tournament={}))}(jat||(jat={}));
//# sourceMappingURL=jatennis.min.js.map